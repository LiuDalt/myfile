/*! author : river.cao , create by: 2016-10-11 */
!function(a,b,c,d){function e(a,b,d){var e=c('<ul class="pages"></ul>');e.append(g("首页",a,b,d)).append(g("上一页",a,b,d));var h=1,i=8,j="<li class='thpoint'>...</li>";a>4&&(h=a-3,i=a+3),i>b&&(h=b-8,i=b,j=""),h<1&&(h=1);for(var k=h;k<=i;k++){var l=c('<li class="page-number">'+k+"</li>");k==a?l.addClass("pgCurrent"):l.click(function(){d(this.firstChild.data)}),l.appendTo(e)}e.append(j).append(g("下一页",a,b,d)).append(g("末页",a,b,d)),e.append("<li class='thpoint pagetotal' style='margin-top:3px;'>共 "+b+" 页</li>");var m=c("<li class='thpoint pagenow'>当前<input type='text' value='"+a+"'maxlength='6' id='gotoval' style='width:20px; height:16px;margin-top:-3px;padding-top:2px;padding-left:10px;'/>页</li>");return e.append(m),e.append(f("确定",b,d)),e}function f(a,b,d){var e=c('<li class="pgNext go">'+a+"</li>");return e.click(function(){var a=c("#gotoval").val(),e=parseInt(a),f=/^[1-9]*[1-9][0-9]*$/;return f.exec(e)?e>b?void alert("您输入的页数超过总页数"+b):void d(e):(alert("请输入非零的正整数！"),!1)}),e}function g(a,b,d,e){var f=c('<li class="pgNext">'+a+"</li>"),g=1;switch(a){case"首页":g=1;break;case"上一页":g=b-1;break;case"下一页":g=b+1;break;case"末页":g=d}return"首页"==a||"上一页"==a?b<=1?f.addClass("pgEmpty"):f.click(function(){e(g)}):b>=d?f.addClass("pgEmpty"):f.click(function(){e(g)}),f}if("error"==d)return void alert("JKcomments没有定义");if(void 0==d.model)return alert("model未定义"),!1;if(void 0==d.item_id)return alert("item_id"),!1;var h=document.location.host.split("."),i=h.length-1,j=h.length-2,k="."+h[j]+"."+h[i],l=function(){this.allfile=[["http://sw1"+k+"/home/css/comments.min.css","css"]],this.config={JKURL:"http://ws"+k+"/comment/lists",JKDELE:"http://ws"+k+"/comment/delete",JKADD:"http://ws"+k+"/comment/add",JKUSERINFOR:"http://ws"+k+"/user/current",JKLIKE:"http://ws"+k+"/comment/like",JKCOLLECT:"http://ws"+k+"/comment/collect",JKREPORT:"http://ws"+k+"/comment/report",JKMINTXT:"说点什么吧...不少于10个字符",JKMAXTXT:"不能超过500个字符",IMGEROR:"请输入正确的图片地址",ERROR:"网络错误请刷新重试！"}};l.prototype={innerScriptOrStyle:function(a,c){if(void 0==c||"script"==c){var d=b.createElement("script"),e=b.head||b.getElementsByTagName("head")[0]||b.documentElement;d.type="text/javascript",d.src=a,d.async="async",d.charset="utf-8"}else if("css"==c||"style"==c){var d=b.createElement("link"),e=b.head||b.getElementsByTagName("head")[0]||b.documentElement;d.type="text/css",d.rel="stylesheet",d.href=a}e.insertBefore(d,e.firstChild)},addLink:function(){for(var a=this,b=a.allfile,c=0;c<b.length;c++)a.innerScriptOrStyle(b[c][0],b[c][1])},_lockey:!0,elementBind:function(){var a=this;c("#txt-btn").unbind("click"),c("#txt-remove").unbind("click"),c("#txt-reply").unbind("click"),c("#jkcomments").keyup(function(b){if(b.ctrlKey&&13==b.keyCode){if(0==a._lockey)return!1;a._lockey=!1,c("#editor").blur(),c("#txt-btn").click()}}),c("#txt-btn").bind("click",{self:this},a.addList),c("#editor").on("keyup",function(){var a=c(this).val().length;a>500&&(c(this).val(c(this).val().substring(0,500)),a=500);var b=a;c("#wordsize em").text(b)}),c(".jkaddpic").on("click",function(){var a='<img src="图片链接地址">',b=c("#editor").val(),d=b+a;c("#editor").val(d)}),c(".txt-jubao>dl>dd").on("click",{self:a},a.jubao),c(".txt-shoucang").on("click",{self:a},a.shoucang),c(".txt-zan").on("click",{self:a},a.clickZan),c(".txt-remove").bind("click",{self:a},a.deleList),c(".txt-reply").bind("click",{self:a},a.txtReply)},jkAjax:function(a){function b(a){if(200==a.code){var b="<ul></ul>";c("#jkcomments").empty(),c("#jkcomments").prepend(b),c("#jkcomments").append('<div id="pager"></div>');for(var e=a.data.list,g=0;g<e.length;g++){e[g].time=h.creatTime(Date.parse(e[g].created_at.replace(/[-]/g,"/"))/1e3);var i=h.creatEle(e[g]);c("#jkcomments>ul").append(i)}if(200==d.login){var j={pic:d.pic_url,uname:d.uname,domain:d.domain};h.editor(j)}else h.theLogin();var k=function(b){c("#pager").pager({pagenumber:b,pagecount:a.data.total_pages,buttonClickCallback:k}),h.jkAjax(b)};if(a.data.total_pages>1&&c("#pager").pager({pagenumber:a.data.page,pagecount:a.data.total_pages,buttonClickCallback:k}),h.elementBind(),void 0!=f){var l=c("#jkcomments").find("#"+f).offset().top,m=c(window).innerHeight();l-m>0&&c("html,body").animate({scrollTop:l},500)}}else alert(a.msg)}function e(){alert(self.config.ERROR)}var f;void 0==a&&(f=document.location.href.split("#")[1]);var g={model:d.model,item_id:d.item_id,parent_id:d.parent_id||"",page:a||1,perPage:d.perPage||5,target:f||""},h=this;h.ajaxFun(h.config.JKURL,"get",g,"jsonp",b,e)},theLogin:function(){var a='<div class="jkxy-subask-nologin">';a+='只有登录了才能参与评论，快<a href="http://passport.jikexueyuan.com/sso/login">登录</a>',a+='！如果你还没有账号你可以<a href="http://passport.jikexueyuan.com/sso/reg_phone" >注册</a>一个账号。</div>',c("#jkcomments").append(a)},creatEle:function(a){var b="<li class='cf'>";return 0==a.is_delete&&(b+="<a href="+a.domain+" target='_blank'>",b+="<img src="+a.pic_url+" class='user-icon'/></a>",b+="<div class='txt'>",b+="<div class='txt-title'>",b+="<a href="+a.domain+" class='txt-name' target='_blank'>",b+=a.uname+"</a>",b+="<span class='txt-floor' id='"+a.floor+"'>#"+a.floor+"</span></div>"),0==a.is_delete?(b+=void 0!=a.reply_uname&&""!=a.reply_uname?"<div class='txt-content'><pre><div class='replybox'>#"+a.reply_floor+"@"+a.reply_uname+"</div>"+a.body+"</pre></div>":"<div class='txt-content'><pre>"+a.body+"</pre></div>",b+="<div class='txt-oter'>",b+="<span class='txt-time'>"+a.time+"</span>",b+=1==a.is_like?"<span class='txt-zan liked' zan_id="+a.id+" >"+a.good_num+"</span>":"<span class='txt-zan' zan_id="+a.id+">"+a.good_num+"</span>",b+="<span class='txt-reply' reply_id="+a.id+">回复</span>",0==a.is_report?(b+="<span class='txt-jubao' jubaoid="+a.id+">",b+="<dl><dd>广告位等垃圾信息</dd><dd>不友善内容</dd><dd>违反法律法规的内容</dd><dd>不宜公开讨论的政治内容</dd><dd>其他</dd></dl>",b+="</span>"):b+=1==a.is_report?"<span class='txt-jubao jubao' jubaoid="+a.id+"></span>":"<span class='txt-jubao' jubaoid="+a.id+"></span>",b+=1==a.is_collect?"<span class='txt-shoucang shoucang' scid="+a.id+"></span>":"<span class='txt-shoucang' scid="+a.id+"></span>",1==a.is_self&&(b+="<span class='txt-remove' id="+a.id+"></span>"),b+="</div>"):b+="<div class='txt-content'><p style='font-size:12px; color:#999;text-align: center; padding:20px 0px'>被带到火星去了</p></div>",b+="</div>"},editor:function(a){var b='<div class="editor-layout cf"><a href='+a.domain+' target="_blank"><img src='+a.pic+" alt="+a.uname+' class="user-icon" /></a>';b+='<div class="textbox">',b+="<div id='talkfloor'></div>",b+='<textarea id="editor" placeholder="说点什么吧…不少于10个字符"></textarea>',b+='<div class="toolbox"><span class="emotion"><img src="http://sw1'+k+'/home/images/arclist/one.png"/></span>',b+='<span class="jkaddpic"></span>',b+='<button class="greenbtn" id="txt-btn">提交回复</button><span id="wordsize"><em>0</em>/500</span></div></div></div>',c("#jkcomments").append(b),c(".emotion").qqFace({assign:"saytext",path:"face/"})},gotoSubask:function(){var a=c("#jkcomments").find(".jkxy-subask-nologin").offset().top,b=c(window).innerHeight();a-b>0&&c("html,body").animate({scrollTop:a},500)},txtReply:function(a){if(""==d.uname)a.data.self.gotoSubask();else{a.data.self.keyFunc();var b=c("#jkcomments").find(".editor-layout").offset().top,e=c(window).innerHeight(),f=c(this).parents("li").find(".txt-floor").text(),g=c(this).parents("li").find(".txt-name").text(),h=f+"@"+g;d.reply_id=c(this).attr("reply_id"),c("#jkcomments>.editor-layout>.textbox").find("#talkfloor").html(h).show(),c("#jkcomments>.editor-layout>.textbox").find("#editor").css("paddingTop","30px"),b-e>0&&c("html,body").animate({scrollTop:b},500,function(){c("#jkcomments>.editor-layout>.textbox").find("#editor").focus()})}},keyFunc:function(){c(window).keydown(function(a){switch(a.keyCode){case 8:var b=c("#jkcomments>.editor-layout>.textbox").find("#editor");b.val().length<=0&&(c("#jkcomments>.editor-layout>.textbox").find("#talkfloor").html("").hide(),d.reply_id="",b.css("paddingTop","10px"))}})},addList:function(a){function b(){g._lockey=!0,i.attr("disabled",!1)}function e(a){switch(a.code){case 200:alert("评论成功!"),g.jkAjax();break;default:alert(a.msg)}}function f(){alert(g.config.ERROR)}var g=a.data.self,h=c("#jkcomments>.editor-layout>.textbox").find("#editor").val().substr(0,500);if(h.indexOf("图片链接地址")>=0)return void alert(g.config.IMGEROR);if(h.length<10)return void alert(g.config.JKMINTXT);if(h.length>500)return void alert(g.config.JKMAXTXT);c(this).attr("disabled",!0);var i=c(this),j={model:d.model,item_id:d.item_id,parent_id:d.parent_id||"",reply_id:d.reply_id||"",body:h};g.ajaxFun(g.config.JKADD,"get",j,"jsonp",e,f,b)},jubao:function(a){function b(a){switch(a.code){case 200:g.parents(".txt-jubao").addClass("jubao"),g.parent("dl").remove();break;default:alert(a.msg)}}function e(){alert(f.config.ERROR)}if(""==d.uname)return a.data.self.gotoSubask(),!1;var f=a.data.self,g=c(this),h=g.parents(".txt-jubao").attr("jubaoid"),i=g.text(),j={topic_id:h,content:i};f.ajaxFun(f.config.JKREPORT,"get",j,"jsonp",b,e)},shoucang:function(a){function b(a){switch(a.code){case 200:0==f?(h.addClass("shoucang"),h.append("<span id='scone'>收藏</span>"),c("#scone").animate({top:"-30px",opacity:.3},1e3,function(){c("#scone").remove()})):1==f&&(h.removeClass("shoucang"),h.append("<span id='scone'>取消</span>"),c("#scone").animate({top:"-30px",opacity:.3},1e3,function(){c("#scone").remove()}));break;default:alert(a.msg)}}function e(){alert(g.config.ERROR)}if(""==d.uname)return a.data.self.gotoSubask(),!1;var f,g=a.data.self,h=c(this),i=h.attr("scid");f=h.hasClass("shoucang")?1:0;var j={topic_id:i,collect_type:f};g.ajaxFun(g.config.JKCOLLECT,"get",j,"jsonp",b,e)},clickZan:function(a){function b(a){switch(a.code){case 200:var b=h.text();0==f?(b++,h.addClass("liked"),h.html(b),h.append("<span id='zanone'>+1</span>"),c("#zanone").animate({top:"-30px",opacity:0,fontSize:"14px"},1e3,function(){c("#zanone").remove()})):1==f&&(b--,b<0&&(b=0),h.removeClass("liked"),h.html(b),h.append("<span id='zanone'>-1</span>"),c("#zanone").animate({top:"-30px",opacity:.3},1e3,function(){c("#zanone").remove()}));break;default:alert(a.msg)}}function e(){alert(g.config.ERROR)}if(""==d.uname)return a.data.self.gotoSubask(),!1;var f,g=a.data.self,h=c(this),i=h.attr("zan_id");f=h.hasClass("liked")?1:0;var j={topic_id:i,like_type:f};g.ajaxFun(g.config.JKLIKE,"get",j,"jsonp",b,e)},deleList:function(a){function b(a){switch(a.code){case 200:g.parents("li").remove();var b=c("#jkcomments>ul>li").length;1==b&&f.jkAjax();break;default:alert(a.msg)}}function e(){alert(f.config.ERROR)}if(""==d.uname)return!1;if(!confirm("确定要删除评论吗？"))return!1;var f=a.data.self,g=c(this),h=g.attr("id"),i={id:h};f.ajaxFun(f.config.JKDELE,"get",i,"jsonp",b,e)},getUserInfor:function(){function a(a){200!=a.code&&10101!=a.code||(d.login=a.code,d.uname=a.data.uname||"",d.pic_url=a.data.pic||"",d.domain=a.data.domain||"",c.jkAjax())}function b(){alert(c.config.ERROR)}var c=this;this.ajaxFun(c.config.JKUSERINFOR,"get",{},"jsonp",a,b)},ajaxFun:function(a,b,d,e,f,g,h){c.ajax({type:b,url:a,data:d,dataType:e,success:f,complete:h,error:g,async:!0})},creatTime:function(a){var b,c,d,e,f=parseInt((new Date).getTime()/1e3);if(e=f-a,d=parseInt(e/86400),c=parseInt(e/3600),b=parseInt(e/60),d>0&&d<4)return d+"天前";if(d<=0&&c>0)return c+"小时前";if(c<=0&&b>0)return b+"分钟前";if(b<=0)return"刚刚";if(d>=4){var g=new Date(1e3*a),h=g.getMonth()+1;return g.getFullYear()+"年"+h+"月"+g.getDate()+"日"}}};var m=new l;m.getUserInfor(),m.addLink(),c.fn.pager=function(a){c.extend({},c.fn.pager.defaults,a);return this.each(function(){c(this).empty().append(e(parseInt(a.pagenumber),parseInt(a.pagecount),a.buttonClickCallback)),c(".pages li").mouseover(function(){document.body.style.cursor="pointer"}).mouseout(function(){document.body.style.cursor="auto"})})},c.fn.pager.defaults={pagenumber:1,pagecount:1}}(window,document,jQuery,function(){return"undefined"!=typeof JKcomments?JKcomments:"error"}()),function(a){var b=document.location.host.split("."),c=b.length-1,d=b.length-2,e="."+b[d]+"."+b[c];a.fn.qqFace=function(){var b={id:"facebox",path:"images/arclist/",assign:"editor",tip:"em_"},c=b.assign,d=b.id,f=b.path,g=b.tip;a(".emotion").click(function(b){var h=a(".emotion").offset().top+146;a("html,body").animate({scrollTop:h},800);var i,j;if(a("#"+d).length<=0){i='<div id="'+d+'" style="position:absolute;display:none;z-index:1000;" class="qqFace"><table border="0" cellspacing="0" cellpadding="0"><tr>';for(var k=1;k<=75;k++)j="["+g+k+"]",i+='<td><img src="http://sw1'+e+"/home/"+f+k+'.gif" onclick="$(\'#'+c+"').insertAtCaret('"+j+"');\" /></td>",k%15==0&&(i+="</tr><tr>");i+="</tr></table></div>"}a(this).parent().append(i);var l=a(this).position(),m=l.top+a(this).outerHeight();a("#"+d).css("top",m),a("#"+d).css("left",l.left),a("#"+d).show(),b.stopPropagation()}),a(document).click(function(){a("#"+d).hide(),a("#"+d).remove()})}}(jQuery),jQuery.extend({unselectContents:function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}}),jQuery.fn.extend({selectContents:function(){$(this).each(function(a){var b,c,d,e,f=this;(d=f.ownerDocument)&&(e=d.defaultView)&&"undefined"!=typeof e.getSelection&&"undefined"!=typeof d.createRange&&(b=window.getSelection())&&"undefined"!=typeof b.removeAllRanges?(c=d.createRange(),c.selectNode(f),0==a&&b.removeAllRanges(),b.addRange(c)):document.body&&"undefined"!=typeof document.body.createTextRange&&(c=document.body.createTextRange())&&(c.moveToElementText(f),c.select())})},setCaret:function(){},insertAtCaret:function(a){var b=$(this).get(0);if(document.all&&b.createTextRange&&b.caretPos){var c=b.caretPos;c.text=""==c.text.charAt(c.text.length-1)?a+"":a}else if(b.setSelectionRange){var d=b.selectionStart,e=b.selectionEnd,f=b.value.substring(0,d),g=b.value.substring(e);b.value=f+a+g,b.focus();var h=a.length;b.setSelectionRange(d+h,d+h),b.blur()}else b.value+=a}});