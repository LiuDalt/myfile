
<!-- saved from url=(0113)http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&method=dequeueOutputBuffer -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Java Code Example </title>
<script data-rocketsrc="https://pagead2.googlesyndication.com/pub-config/r20160913/ca-pub-5732630628268628.js" data-rocketoptimized="true"></script><script async="" data-rocketsrc="//www.google-analytics.com/analytics.js" data-rocketoptimized="true"></script><script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"6075f8beb482c729e127dc3ec17b5d1d",petok:"86a38a6b3a04bcecc2ff4308845a188afe64dbbf-1486958124-1800",zone:"programcreek.com",rocket:"a",apps:0}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=f2befc48d1/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script><script type="text/javascript" src="./Java Code Example_files/cloudflare.min.js.下载"></script><style type="text/css">.cf-hidden { display: none; } .cf-invisible { visibility: hidden; }</style><script data-module="cloudflare/rocket" id="cfjs_block_3bfc8cba39" onload="CloudFlare.__cfjs_block_3bfc8cba39_load()" onerror="CloudFlare.__cfjs_block_3bfc8cba39_error()" onreadystatechange="CloudFlare.__cfjs_block_3bfc8cba39_readystatechange()" type="text/javascript" src="./Java Code Example_files/rocket.js.下载"></script>
<link type="text/css" rel="stylesheet" media="screen" href="./Java Code Example_files/main.css">
<script data-rocketsrc="./includes/js/dist/libs/jquery.js" type="text/rocketscript" data-rocketoptimized="true"></script>
<script language="javaScript" data-rocketsrc="./includes/js/jquery.highlight-3.js" type="text/rocketscript" data-rocketoptimized="true"></script>


<link type="text/css" rel="stylesheet" media="screen" href="./Java Code Example_files/prettify.css">
<script language="javaScript" data-rocketsrc="./includes/js/google-code-prettify/prettify.js" type="text/rocketscript" data-rocketoptimized="true"></script>

     		<meta name="keywords" content="Java API examples">
						
		
	</head>

<body onload="(function(a){window.CloudFlare &amp;&amp; window.CloudFlare.push(function(b){b([&quot;cloudflare/rocket&quot;],function(c){c.push(function(){(function(){prettyPrint()}).call(a)})})})})(this);">

	<!-- BuySellAds Ad Code 
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = '//s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
End BuySellAds Ad Code -->

	<script type="text/rocketscript" data-rocketoptimized="true">
			  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			
			  ga('create', 'UA-7639629-4', 'auto');
			  ga('send', 'pageview');
			
	</script>

<div id="header">
	<div id="header-center">


		<span id="navigation"> 
		
	
			<!-- <img alt="Program Creek" src="./includes/images/pc-logo.png" width="80px" /> &nbsp;&nbsp; -->
			<a href="http://www.programcreek.com/java-api-examples/index.php">Search</a> 
			&nbsp;&nbsp;
			<a href="http://www.programcreek.com/java-api-examples/index.php?action=index">Top APIs</a>
			&nbsp;&nbsp;
			<a href="http://www.programcreek.com/2015/12/top-10-java-utility-classes/">Top 16 Utility Classes</a>
			<!--   &nbsp; &nbsp; 
	     	<a href="http://www.programcreek.com/2015/12/top-10-api-related-questions-from-stack-overflow/">Top 10 API Questions</a>
 			-->
	     	&nbsp; &nbsp; 
	     	<a href="http://www.programcreek.com/">Program Creek</a>
 
 &nbsp; &nbsp; 
	     	<a href="http://www.programcreek.com/simple-java/">Simple Java</a>
 

		</span> 
		
				<span id="login">
			
							<a href="http://www.programcreek.com/java-api-examples/index.php?action=login">Log in</a>
				&nbsp; &nbsp;
				<a href="http://www.programcreek.com/java-api-examples/index.php?action=register">Sign up</a>
				<span style="font-size:11px; color:#FA7070; ">(Free now!)</span>
			
			&nbsp; &nbsp;
			<span style="font-size:12px; color:grey; ">7488 users</span>
				
		</span>


		<!-- 
		<span style="float:right; margin-top: 4px;">
				<ins class="adsbygoogle"
				     style="display:inline-block;width:728px;height:15px"
				     data-ad-client="ca-pub-5732630628268628"
				     data-ad-slot="9596194014"></ins>
				<script>
				(adsbygoogle = window.adsbygoogle || []).push({});
				</script>
		
		</span>
		
		-->

		<!-- 
		<div class="addthis_toolbox addthis_default_style" style="width:50%">
		<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
		<a class="addthis_button_tweet"></a>
		<a class="addthis_counter addthis_pill_style"></a>
		</div>
		<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=xa-4e1a385f21c923c3"></script>
	-->



		<!--
	<span style="width:200px;float:left;">
	<table width="20%">
	<tr>
	<td width="50%"><div class="fb-like" data-send="false" data-layout="button_count" data-width="450" data-show-faces="false"></div></td>
	<td width="20%"><div class="g-plusone" data-size="medium"></div></td>
	<td width="30%"><a href="https://twitter.com/share" class="twitter-share-button" data-via="ProgramCreek">Tweet</a>
	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></td>
	</tr>
	</table>
	</span>
	-->


	</div>
</div>

<div style="clear: both; width: 100%;"></div>

 
    

		 
<link type="text/css" rel="stylesheet" media="screen" href="./Java Code Example_files/jquery.qtip.min.css">
<script language="javaScript" data-rocketsrc="./includes/js/qtip/jquery.qtip.min.js" type="text/rocketscript" data-rocketoptimized="true"></script>

<style>
	.myCustomClass{
		border-color: #d8d8d8;
		background-color: #f7f7f7;
	}
</style>


<div id="content">

<style>
 .sidebarbox{
 	border: 1px solid #d8d8d8;
    border-radius: 3px;
     /*e0dcbf*/
 	padding: 0px;
    word-wrap: break-word;
 }
 
 .sidebarbox li{
 	 list-style-image: url('./includes//images/c2.png');
 }
 
 .sidebarboxheader{
 	font-size: 17px; 
 	padding: 5px 0 5px 10px; 
 	border-bottom: 1px solid #d8d8d8;
     background-color: #f7f7f7;
 }
 
 .sidebarboxbody{
 	margin: 2px 0px 0px 18px; 
 	padding: 5px;
 }

 #view_complete_list:hover{
     cursor:pointer;
     cursor:hand;
 }

</style>

<script language="javaScript" type="text/rocketscript" data-rocketoptimized="true">
    $(document).ready(function(){
        //$('#memo').focus();
        //click to delete
        $('#view_complete_list').click(function(){

            $(this).hide();
            //alert(item_id);
           $(".memberList").show();
        });

        $('#commentMethod').qtip({ // Grab some elements to apply the tooltip to
            content: {
                text: 'View examples for common methods or constants'
            },

            style: { classes: 'myCustomClass' },
            position: {

                at: 'bottom center', // at the bottom right of...

            }

        })

        $('#relatedClass').qtip({ // Grab some elements to apply the tooltip to
            content: {
                text: 'View examples for related classes'
            },

            style: { classes: 'myCustomClass' },

            position: {

                at: 'bottom center', // at the bottom right of...

            }
        })

    });
</script>

<div id="sidebar-example">

	<div style="height: 25px;clear:both;"></div>

 		
      
    
	
   <!-- BuySellAds Zone Code 
            <div style="height: 10px;clear:both;"></div>
			<div id="bsap_1299825" class="bsarocks bsap_ad707c165f518838b76571b6022c3c68"></div>
			 <div style="height: 10px;clear:both;"></div>
			End BuySellAds Zone Code -->

        <!--aspose 
		 
		<a id="aspose" href="http://www.aspose.com/total-component-suite.aspx?utm_source=ProgramCreek&utm_medium=banner&utm_campaign=ProgramCreek-1">
		 <img src="http://www.programcreek.com/aspose.gif" alt="" style="width:300px;height:250px;"> 
		</a>
		
		<div style="height: 10px;clear:both;"></div>
		-->  
		
		
		
		  
		  <ins class="adsbygoogle" style="display: inline-block; width: 300px; height: 250px;" data-ad-client="ca-pub-5732630628268628" data-ad-slot="1961849215" data-adsbygoogle-status="done"><ins id="aswift_0_expand" style="display:inline-table;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><ins id="aswift_0_anchor" style="display:block;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><iframe width="300" height="250" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;" src="./Java Code Example_files/saved_resource.html"></iframe></ins></ins></ins>
                <script type="text/rocketscript" data-rocketoptimized="true">
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
		
        <div style="height: 10px;clear:both;"></div>






       
            <!-- Related Classes -->
            <div class="sidebarbox">
                <div class="sidebarboxheader" id="relatedClass" data-hasqtip="1"><b>Top Related Classes</b></div>
                <div class="sidebarboxbody">
                    <ul>
                                                    <li>
                                <a href="http://www.programcreek.com/java-api-examples/index.php?api=android.util.Log">android.util.Log</a>
                            </li>
                                                        <li>
                                <a href="http://www.programcreek.com/java-api-examples/index.php?api=android.annotation.SuppressLint">android.annotation.SuppressLint</a>
                            </li>
                                                        <li>
                                <a href="http://www.programcreek.com/java-api-examples/index.php?api=com.google.android.exoplayer.MediaCodecAudioTrackRenderer">com.google.android.exoplayer.MediaCodecAudioTrackRenderer</a>
                            </li>
                                                        <li>
                                <a href="http://www.programcreek.com/java-api-examples/index.php?api=android.media.MediaFormat">android.media.MediaFormat</a>
                            </li>
                                                        <li>
                                <a href="http://www.programcreek.com/java-api-examples/index.php?api=android.media.MediaCodec.BufferInfo">android.media.MediaCodec.BufferInfo</a>
                            </li>
                                                        <li>
                                <a href="http://www.programcreek.com/java-api-examples/index.php?api=org.chromium.base.CalledByNative">org.chromium.base.CalledByNative</a>
                            </li>
                                                        <li>
                                <a href="http://www.programcreek.com/java-api-examples/index.php?api=java.nio.ByteBuffer">java.nio.ByteBuffer</a>
                            </li>
                                                        <li>
                                <a href="http://www.programcreek.com/java-api-examples/index.php?api=java.io.IOException">java.io.IOException</a>
                            </li>
                                                        <li>
                                <a href="http://www.programcreek.com/java-api-examples/index.php?api=com.google.android.exoplayer.MediaCodecVideoTrackRenderer">com.google.android.exoplayer.MediaCodecVideoTrackRenderer</a>
                            </li>
                                                        <li>
                                <a href="http://www.programcreek.com/java-api-examples/index.php?api=android.media.MediaExtractor">android.media.MediaExtractor</a>
                            </li>
                                                        <li>
                                <a href="http://www.programcreek.com/java-api-examples/index.php?api=com.google.android.exoplayer.TrackRenderer">com.google.android.exoplayer.TrackRenderer</a>
                            </li>
                                                        <li>
                                <a href="http://www.programcreek.com/java-api-examples/index.php?api=android.media.MediaCodecInfo">android.media.MediaCodecInfo</a>
                            </li>
                            

                    </ul>

                </div>
            </div>
            <!-- END Related Classes -->
           
                       
            <!-- Ad after Related Classes -->
            	<script async="" data-rocketsrc="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" type="text/rocketscript" data-rocketoptimized="true"></script>

                <div style="height: 10px;clear:both;"></div>

                <ins class="adsbygoogle" style="display: inline-block; width: 300px; height: 250px;" data-ad-client="ca-pub-5732630628268628" data-ad-slot="1961849215" data-adsbygoogle-status="done"><ins id="aswift_1_expand" style="display:inline-table;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><ins id="aswift_1_anchor" style="display:block;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><iframe width="300" height="250" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_1" name="aswift_1" style="left:0;position:absolute;top:0;" src="./Java Code Example_files/saved_resource(1).html"></iframe></ins></ins></ins>
                <script type="text/rocketscript" data-rocketoptimized="true">
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                
             <!-- END Ad after Related Classes -->   
       		            
                    
        

        
        
               
                   <!-- Common Methods --> 
           <div style="height: 10px;clear:both;"></div>
             
           <div class="sidebarbox">
                <div class="sidebarboxheader" id="commentMethod" data-hasqtip="0"><b>Frequently Used Methods</b></div>
                <div class="sidebarboxbody">
                    <ul>
                                                    <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=BufferInfo">
                                    BufferInfo                                        ( )
                                                                        </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=releaseOutputBuffer">
                                    releaseOutputBuffer                                        ( )
                                                                        </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=createByCodecName">
                                    createByCodecName                                        ( )
                                                                        </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=INFO_OUTPUT_BUFFERS_CHANGED">
                                    INFO_OUTPUT_BUFFERS_CHANGED                                </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=VIDEO_SCALING_MODE_SCALE_TO_FIT">
                                    VIDEO_SCALING_MODE_SCALE_TO_FIT                                </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=INFO_OUTPUT_FORMAT_CHANGED">
                                    INFO_OUTPUT_FORMAT_CHANGED                                </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=createEncoderByType">
                                    createEncoderByType                                        ( )
                                                                        </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=INFO_TRY_AGAIN_LATER">
                                    INFO_TRY_AGAIN_LATER                                </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=configure">
                                    configure                                        ( )
                                                                        </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=BUFFER_FLAG_END_OF_STREAM">
                                    BUFFER_FLAG_END_OF_STREAM                                </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=createDecoderByType">
                                    createDecoderByType                                        ( )
                                                                        </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=BUFFER_FLAG_CODEC_CONFIG">
                                    BUFFER_FLAG_CODEC_CONFIG                                </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=dequeueOutputBuffer">
                                    dequeueOutputBuffer                                        ( )
                                                                        </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=CryptoInfo">
                                    CryptoInfo                                        ( )
                                                                        </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=queueInputBuffer">
                                    queueInputBuffer                                        ( )
                                                                        </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=getOutputFormat">
                                    getOutputFormat                                        ( )
                                                                        </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=getOutputBuffers">
                                    getOutputBuffers                                        ( )
                                                                        </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=setVideoScalingMode">
                                    setVideoScalingMode                                        ( )
                                                                        </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=start">
                                    start                                        ( )
                                                                        </a>

                            </li>

                                                        <li class="memberList">
                                <a href="http://www.programcreek.com/java-api-examples/index.php?class=android.media.MediaCodec&amp;method=stop">
                                    stop                                        ( )
                                                                        </a>

                            </li>

                            
                      
                    </ul>

                    <!--
                    <span style="font-size: 11px">
                            <a href="http://www.programcreek.com/java-api-examples/index.php?action=register">Sign up to view the complete list</a>
                    </span>
                    -->
                </div>
            </div>
            
             <!-- 
             <div style="height: 10px;clear:both;"></div>
               
	         <ins class="adsbygoogle"
	                     style="display:inline-block;width:300px;height:250px"
	                     data-ad-client="ca-pub-5732630628268628"
	                     data-ad-slot="3672680817"></ins>
	         <script>
	                (adsbygoogle = window.adsbygoogle || []).push({});
	         </script>
			-->
               
              
             
        
        
       

               
		
                
        <!-- 
         		<div style="height: 10px;clear:both;"></div>

                <ins class="adsbygoogle"
                     style="display:inline-block;width:300px;height:250px"
                     data-ad-client="ca-pub-5732630628268628"
                     data-ad-slot="3672680817"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
		
                <div style="height: 10px;clear:both;"></div>

                <ins class="adsbygoogle"
                     style="display:inline-block;width:300px;height:250px"
                     data-ad-client="ca-pub-5732630628268628"
                     data-ad-slot="5172936410"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                
        
        		<div style="height: 10px;clear:both;"></div>



                <ins class="adsbygoogle"
                     style="display:inline-block;width:300px;height:250px"
                     data-ad-client="ca-pub-5732630628268628"
                     data-ad-slot="3672680817"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>

                <div style="height: 10px;clear:both;"></div>

                <ins class="adsbygoogle"
                     style="display:inline-block;width:300px;height:250px"
                     data-ad-client="ca-pub-5732630628268628"
                     data-ad-slot="5172936410"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
       -->         
                <div style="height: 10px;clear:both;"></div>
                
                <ins class="adsbygoogle" style="display:inline-block;width:300px;height:600px" data-ad-client="ca-pub-5732630628268628" data-ad-slot="6392048811" data-adsbygoogle-status="done"><ins id="aswift_2_expand" style="display:inline-table;border:none;height:600px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><ins id="aswift_2_anchor" style="display:block;border:none;height:600px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><iframe width="300" height="600" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_2" name="aswift_2" style="left:0;position:absolute;top:0;" src="./Java Code Example_files/saved_resource(2).html"></iframe></ins></ins></ins>
                <script type="text/rocketscript" data-rocketoptimized="true">
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
           
           
           
            
            
         
           
                
                
        
        
    


 

          
</div>
<div id="main">

<script language="javaScript" type="text/rocketscript" data-rocketoptimized="true">
$(document).ready(function(){
	//$('#memo').focus();
	//click to delete
	$('.vote').click(function(){
		var item_id = $(this).attr("id");
		$(this).text("thanks");
		$(this).fadeOut();
		var realId = item_id.split("=")[0];
		//alert("good".concat(realId));
		var oldVotes = $('#'.concat(realId).concat("votes")).text();
		var newVotes = parseInt(oldVotes)+1;

		//alert(newVotes);
		$('#'.concat(realId).concat("votes")).text(newVotes);

		$.post('back.php',
		{
			todo: "vote",
			method_id: item_id 
			
		},function(data){
			$('#memo_list').text(data);
		});	
	});


	$('#saveMethod').click(function(){

		var className = $(this).attr("classname");
		var userId = $(this).attr("userid");
		var methodName = $(this).attr("methodname");

		if(!userId){
			alert("Sign up first to save");
			exit();
		}



		//$(this).prop("disabled",true);
		$(this).fadeOut();


		//alert(item_id);
		$.post('./back.php',
				{
					todo: "saveMethod",
					className: className,
					userId:userId,
					methodName:methodName

				},function(data){
					//$('#memo_list').text(data);
				});
	});



	$('.vote').qtip({ // Grab some elements to apply the tooltip to
		content: {
			text: 'This example is useful'
		},

		style: { classes: 'myCustomClass' }
	})

		$('#saveMethod').qtip({ // Grab some elements to apply the tooltip to
		content: {
			text: 'Sign up first to save'
		},

		style: { classes: 'myCustomClass' }
	})

	
});
</script>


<h1 style="font-weight:100;
	color:#333333;
	font-size: 24px;
    line-height: 34px;
	letter-spacing:0px;
	text-align:center;
	margin-bottom:10px;">
	Java Code Examples for <span style="">android.media.MediaCodec.<i>dequeueOutputBuffer()</i> </span>
</h1>
	



	<div style="margin-top:10px;">
		<p>
			The following are <span style="color:#0B97D4;"><i></i></span> Jave code examples for showing how to use
			<span style="color:#3A5099;">
				dequeueOutputBuffer()			</span> of the
			<span style="color:#3A5099;">
				<a href="http://www.programcreek.com/java-api-examples/index.php?api=android.media.MediaCodec">android.media.MediaCodec</a>
			</span> class.
			You can vote up the examples you like. Your votes will be used in our system to get
			more good examples. <br>
		</p>
	</div>

	<div style="margin: 20px 0; width;100%;">
		<div id="saveMethod" class="click_button" classname="android.media.MediaCodec" userid="" methodname="dequeueOutputBuffer" style="float:right;" data-hasqtip="18">
			<span style="font-weight: 900;">+</span> Save this method
		</div>

	</div>
	<div style=" height: 5px;">

	</div>


			<!-- 1. example number -->
		<div style="margin:20px 2px; color:#424345; font-weight:bold;">Example 1</div>

		<div class="examplebox">

			<!-- 2. description -->
			<div class="exampleboxheader">
				<table width="100%">

					<tbody><tr>

						<td width="85%" style="padding: 2px; font-size:14px;line-height: 25px;">
							Project: <span style="font-style:italic;">spydroid-ipcamera-master</span>
							<!--File:  <span style="font-style:italic;">/src/net/majorkernelpanic/streaming/hw/EncoderDebugger.java</span>-->
							<a href="http://www.programcreek.com/java-api-examples/index.php?source_dir=spydroid-ipcamera-master/src/net/majorkernelpanic/streaming/hw/EncoderDebugger.java">
								<span style="font-style:italic;">View Source</span>
							</a>
						</td>

						<td width="8%" align="right" style="padding-right:5px; font-size:14px;">

								<span class="vote click_button" id="351718==android.media.MediaCodec" data-hasqtip="2">
									<!--<img alt="vote" src="./includes/images/like.png" width="25"/>-->
									Vote up
								</span>
						</td>

						<td width="10%" align="right" style="padding-right:5px; font-size:12px;">
							<span id="351718votes">6</span>
							votes
						</td>
					</tr>
				</tbody></table>




			</div>


			<!-- 3. code -->
			<div class="exampleboxbody">
				<pre class="prettyprint"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> flushMediaCodec</span><span class="pun">(</span><span class="typ">MediaCodec</span><span class="pln"> mc</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="typ">BufferInfo</span><span class="pln"> info </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BufferInfo</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index </span><span class="pun">!=</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_TRY_AGAIN_LATER</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		index </span><span class="pun">=</span><span class="pln"> mc</span><span class="pun">.</span><span class="highlight"><span class="pln">dequeueOutputBuffer</span></span><span class="pun">(</span><span class="pln">info</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1000000</span><span class="pun">/</span><span class="pln">FRAMERATE</span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index</span><span class="pun">&gt;=</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			mc</span><span class="pun">.</span><span class="pln">releaseOutputBuffer</span><span class="pun">(</span><span class="pln">index</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 </span></pre>
			</div>

		</div>



						<!-- 1. example number -->
		<div style="margin:20px 2px; color:#424345; font-weight:bold;">Example 2</div>

		<div class="examplebox">

			<!-- 2. description -->
			<div class="exampleboxheader">
				<table width="100%">

					<tbody><tr>

						<td width="85%" style="padding: 2px; font-size:14px;line-height: 25px;">
							Project: <span style="font-style:italic;">boson-master</span>
							<!--File:  <span style="font-style:italic;">/Boson/boson/src/main/java/com/bytehappy/boson/BosonPlayer.java</span>-->
							<a href="http://www.programcreek.com/java-api-examples/index.php?source_dir=boson-master/Boson/boson/src/main/java/com/bytehappy/boson/BosonPlayer.java">
								<span style="font-style:italic;">View Source</span>
							</a>
						</td>

						<td width="8%" align="right" style="padding-right:5px; font-size:14px;">

								<span class="vote click_button" id="564360==android.media.MediaCodec" data-hasqtip="3">
									<!--<img alt="vote" src="./includes/images/like.png" width="25"/>-->
									Vote up
								</span>
						</td>

						<td width="10%" align="right" style="padding-right:5px; font-size:12px;">
							<span id="564360votes">6</span>
							votes
						</td>
					</tr>
				</tbody></table>




			</div>


			<!-- 3. code -->
			<div class="exampleboxbody">
				<pre class="prettyprint"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> initializeAll</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

        </span><span class="typ">MediaCodec</span><span class="pln"> codec</span><span class="pun">;</span><span class="pln">

        </span><span class="typ">ByteBuffer</span><span class="pun">[]</span><span class="pln"> codecInputBuffers</span><span class="pun">;</span><span class="pln">
        </span><span class="typ">ByteBuffer</span><span class="pun">[]</span><span class="pln"> codecOutputBuffers</span><span class="pun">;</span><span class="pln">

        </span><span class="typ">MediaFormat</span><span class="pln"> format </span><span class="pun">=</span><span class="pln"> </span><span class="typ">_MediaExtractor</span><span class="pun">.</span><span class="pln">getTrackFormat</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
        </span><span class="typ">String</span><span class="pln"> mime </span><span class="pun">=</span><span class="pln"> format</span><span class="pun">.</span><span class="pln">getString</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_MIME</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> channelType </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AudioFormat</span><span class="pun">.</span><span class="pln">CHANNEL_OUT_DEFAULT</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> bitRateMode </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AudioFormat</span><span class="pun">.</span><span class="pln">ENCODING_PCM_16BIT</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">boolean</span><span class="pln"> loop </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">boolean</span><span class="pln"> stopped </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">

        </span><span class="kwd">try</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">

            </span><span class="com">//set duration if supported by format</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">format</span><span class="pun">.</span><span class="pln">containsKey</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_DURATION</span><span class="pun">))</span><span class="pln">
                threadInfo</span><span class="pun">.</span><span class="pln">duration</span><span class="pun">(</span><span class="pln">format</span><span class="pun">.</span><span class="pln">getLong</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_DURATION</span><span class="pun">));</span><span class="pln">
            </span><span class="kwd">else</span><span class="pln">
                threadInfo</span><span class="pun">.</span><span class="pln">duration</span><span class="pun">(-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">

            </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - setup _AudioTrack"</span><span class="pun">);</span><span class="pln">
            </span><span class="typ">_AudioTrack</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AudioTrack</span><span class="pun">(</span><span class="pln">
                    threadInfo</span><span class="pun">.</span><span class="pln">streamType</span><span class="pun">(),</span><span class="pln">
                    sampleRate</span><span class="pun">,</span><span class="pln">
                    </span><span class="typ">AudioFormat</span><span class="pun">.</span><span class="pln">CHANNEL_OUT_DEFAULT</span><span class="pun">,</span><span class="pln">
                    </span><span class="typ">AudioFormat</span><span class="pun">.</span><span class="pln">ENCODING_PCM_16BIT</span><span class="pun">,</span><span class="pln">
                    threadInfo</span><span class="pun">.</span><span class="pln">bufferSize</span><span class="pun">(),</span><span class="pln">
                    TRACK_MODE</span><span class="pun">);</span><span class="pln">
            </span><span class="typ">_AudioTrack</span><span class="pun">.</span><span class="pln">setStereoVolume</span><span class="pun">(</span><span class="pln">threadInfo</span><span class="pun">.</span><span class="pln">dataLeftVolume</span><span class="pun">(),</span><span class="pln"> threadInfo</span><span class="pun">.</span><span class="pln">dataRightVolume</span><span class="pun">());</span><span class="pln">
            framesPerSample </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span><span class="pln">

            </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - start main playback loop"</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">loop </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">!</span><span class="pln">stopped</span><span class="pun">)</span><span class="pln">
            </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">boolean</span><span class="pln"> sawOutputEOS </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">boolean</span><span class="pln"> sawInputEOS </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">

                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - setup codec"</span><span class="pun">);</span><span class="pln">
                codec </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">createDecoderByType</span><span class="pun">(</span><span class="pln">mime</span><span class="pun">);</span><span class="pln">
                codec</span><span class="pun">.</span><span class="pln">configure</span><span class="pun">(</span><span class="pln">format</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="com">/* surface */</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="com">/* crypto */</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="com">/* flags */</span><span class="pun">);</span><span class="pln">
                codec</span><span class="pun">.</span><span class="pln">start</span><span class="pun">();</span><span class="pln">
                codecInputBuffers </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">getInputBuffers</span><span class="pun">();</span><span class="pln">
                codecOutputBuffers </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">getOutputBuffers</span><span class="pun">();</span><span class="pln">

                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - config _MediaExtractor"</span><span class="pun">);</span><span class="pln">
                </span><span class="com">//Select default track, seeks to start in case this is looping</span><span class="pln">
                </span><span class="typ">_MediaExtractor</span><span class="pun">.</span><span class="pln">selectTrack</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
                </span><span class="typ">_MediaExtractor</span><span class="pun">.</span><span class="pln">seekTo</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="typ">MediaExtractor</span><span class="pun">.</span><span class="pln">SEEK_TO_CLOSEST_SYNC</span><span class="pun">);</span><span class="pln">

                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - start buffer loop"</span><span class="pun">);</span><span class="pln">
                </span><span class="com">//This is the loop that actually makes the entire file play it will read through until it reaches the end of both the input and output streams</span><span class="pln">
                </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">sawOutputEOS </span><span class="pun">||</span><span class="pln"> </span><span class="pun">!</span><span class="pln">sawInputEOS</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="com">//This section up until the input buffer section is used to update a audiotrack in MODE_STREAM</span><span class="pln">

                    </span><span class="com">//If the stream is paused this thread does nothing</span><span class="pln">
                    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">paused</span><span class="pun">()){}</span><span class="pln">

                    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">threadInfo</span><span class="pun">.</span><span class="pln">flagStop</span><span class="pun">())</span><span class="pln">
                    </span><span class="pun">{</span><span class="pln">
                        </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - threadInfo.flagStop()"</span><span class="pun">);</span><span class="pln">
                        stopped </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
                        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">threadInfo</span><span class="pun">.</span><span class="pln">flagRelease</span><span class="pun">())</span><span class="pln">
                        </span><span class="pun">{</span><span class="pln">
                            </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - threadInfo.flagRelease()"</span><span class="pun">);</span><span class="pln">
                            </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - release _AudioTrack and _MediaExtractor"</span><span class="pun">);</span><span class="pln">
                            </span><span class="typ">_AudioTrack</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln">
                            </span><span class="typ">_MediaExtractor</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln">
                            </span><span class="typ">_AudioTrack</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
                            threadInfo</span><span class="pun">.</span><span class="pln">released</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span><span class="pln">
                        </span><span class="pun">}</span><span class="pln">
                        </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">

                    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">threadInfo</span><span class="pun">.</span><span class="pln">flagUpdateVolume</span><span class="pun">())</span><span class="pln">
                    </span><span class="pun">{</span><span class="pln">
                        </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - threadInfo.flagUpdateVolume()"</span><span class="pun">);</span><span class="pln">
                        </span><span class="typ">_AudioTrack</span><span class="pun">.</span><span class="pln">setStereoVolume</span><span class="pun">(</span><span class="pln">threadInfo</span><span class="pun">.</span><span class="pln">dataLeftVolume</span><span class="pun">(),</span><span class="pln"> threadInfo</span><span class="pun">.</span><span class="pln">dataRightVolume</span><span class="pun">());</span><span class="pln">
                        threadInfo</span><span class="pun">.</span><span class="pln">flagUpdateVolume</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">

                    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">threadInfo</span><span class="pun">.</span><span class="pln">flagSeek</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - threadInfo.flagSeek()"</span><span class="pun">);</span><span class="pln">
                        </span><span class="typ">_MediaExtractor</span><span class="pun">.</span><span class="pln">seekTo</span><span class="pun">(</span><span class="pln">threadInfo</span><span class="pun">.</span><span class="pln">dataSeekTo</span><span class="pun">(),</span><span class="pln"> </span><span class="typ">MediaExtractor</span><span class="pun">.</span><span class="pln">SEEK_TO_CLOSEST_SYNC</span><span class="pun">);</span><span class="pln">
                        threadInfo</span><span class="pun">.</span><span class="pln">flagSeek</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">

                    </span><span class="com">/**************
                     *
                     * Input buffer
                     * gets the current input buffer and puts the sample data into it then puts it in queue in the codec to decode it
                     * lastly advances the mediaextractor to the next sample
                     *
                     *************/</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">sawInputEOS</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        </span><span class="kwd">int</span><span class="pln"> inputBufIndex </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">dequeueInputBuffer</span><span class="pun">(</span><span class="lit">10000</span><span class="pun">);</span><span class="pln">
                        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">inputBufIndex </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                            </span><span class="typ">ByteBuffer</span><span class="pln"> dstBuf </span><span class="pun">=</span><span class="pln"> codecInputBuffers</span><span class="pun">[</span><span class="pln">inputBufIndex</span><span class="pun">];</span><span class="pln">

                            </span><span class="kwd">int</span><span class="pln"> sampleSize </span><span class="pun">=</span><span class="pln"> </span><span class="typ">_MediaExtractor</span><span class="pun">.</span><span class="pln">readSampleData</span><span class="pun">(</span><span class="pln">dstBuf</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
                            </span><span class="kwd">long</span><span class="pln"> presentationTimeUs </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
                            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sampleSize </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                                sawInputEOS </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
                                sampleSize </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
                            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                                presentationTimeUs </span><span class="pun">=</span><span class="pln"> </span><span class="typ">_MediaExtractor</span><span class="pun">.</span><span class="pln">getSampleTime</span><span class="pun">();</span><span class="pln">
                            </span><span class="pun">}</span><span class="pln">

                            codec</span><span class="pun">.</span><span class="pln">queueInputBuffer</span><span class="pun">(</span><span class="pln">inputBufIndex</span><span class="pun">,</span><span class="pln">
                                    </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="com">//offset</span><span class="pln">
                                    sampleSize</span><span class="pun">,</span><span class="pln">
                                    presentationTimeUs</span><span class="pun">,</span><span class="pln">
                                    sawInputEOS </span><span class="pun">?</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">BUFFER_FLAG_END_OF_STREAM </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
                            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">sawInputEOS</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                                </span><span class="typ">_MediaExtractor</span><span class="pun">.</span><span class="pln">advance</span><span class="pun">();</span><span class="pln">
                            </span><span class="pun">}</span><span class="pln">
                        </span><span class="pun">}</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">

                    </span><span class="com">/**************
                     *
                     * Output buffer
                     * Gets the current output buffer (buffer info is stored in a new bufferInfo() )
                     * If the output buffer is valid it gets the data and writes it to the audiotrack
                     * The first time this happens onPrepared is called since from that point on the audiotrack will be functional
                     * Releases the outputbuffer when done
                     *
                     * If the dequeOutputBuffer returns a negative value it means something has changed.
                     * In the case of the outputBuffers it gets the new output buffer
                     * In the case of the formating it will create a new audiostream to use that is valid for this data
                     *************/</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">sawOutputEOS</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="typ">BufferInfo</span><span class="pln"> info </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="typ">BufferInfo</span><span class="pun">();</span><span class="pln">
                        </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> dequeueResult </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="highlight"><span class="pln">dequeueOutputBuffer</span></span><span class="pun">(</span><span class="pln">info</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10000</span><span class="pun">);</span><span class="pln">

                        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dequeueResult </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                            </span><span class="typ">ByteBuffer</span><span class="pln"> buf </span><span class="pun">=</span><span class="pln"> codecOutputBuffers</span><span class="pun">[</span><span class="pln">dequeueResult</span><span class="pun">];</span><span class="pln">

                            </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> chunk </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[</span><span class="pln">info</span><span class="pun">.</span><span class="pln">size</span><span class="pun">];</span><span class="pln">
                            buf</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">chunk</span><span class="pun">);</span><span class="pln">
                            buf</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">

                            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">chunk</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                                </span><span class="typ">_AudioTrack</span><span class="pun">.</span><span class="pln">write</span><span class="pun">(</span><span class="pln">chunk</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> chunk</span><span class="pun">.</span><span class="pln">length</span><span class="pun">);</span><span class="pln">
                                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">threadInfo</span><span class="pun">.</span><span class="pln">prepared</span><span class="pun">())</span><span class="pln">
                                </span><span class="pun">{</span><span class="pln">
                                    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - onPrepared()"</span><span class="pun">);</span><span class="pln">
                                    threadInfo</span><span class="pun">.</span><span class="pln">prepared</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span><span class="pln">
                                    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">preparedListener </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln">
                                        preparedListener</span><span class="pun">.</span><span class="pln">onPrepared</span><span class="pun">(</span><span class="typ">BosonPlayer</span><span class="pun">.</span><span class="kwd">this</span><span class="pun">);</span><span class="pln">
                                </span><span class="pun">}</span><span class="pln">
                            </span><span class="pun">}</span><span class="pln">
                            codec</span><span class="pun">.</span><span class="pln">releaseOutputBuffer</span><span class="pun">(</span><span class="pln">dequeueResult</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> </span><span class="com">/* render */</span><span class="pun">);</span><span class="pln">

                            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">info</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">&amp;</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">BUFFER_FLAG_END_OF_STREAM</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                                sawOutputEOS </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
                            </span><span class="pun">}</span><span class="pln">
                        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dequeueResult </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_BUFFERS_CHANGED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                            codecOutputBuffers </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">getOutputBuffers</span><span class="pun">();</span><span class="pln">
                        </span><span class="pun">}</span><span class="pln">
                        </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dequeueResult </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_FORMAT_CHANGED</span><span class="pun">)</span><span class="pln">
                        </span><span class="pun">{</span><span class="pln">
                            </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">w</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - MediaCodec.INFO_OUTPUT_FORMAT_CHANGED"</span><span class="pun">);</span><span class="pln">
                            </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">MediaFormat</span><span class="pln"> outFormat </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">getOutputFormat</span><span class="pun">();</span><span class="pln">
                            </span><span class="kwd">int</span><span class="pln"> newSampleRate </span><span class="pun">=</span><span class="pln"> sampleRate</span><span class="pun">;</span><span class="pln">
                            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">outFormat</span><span class="pun">.</span><span class="pln">containsKey</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_SAMPLE_RATE</span><span class="pun">))</span><span class="pln">
                                newSampleRate </span><span class="pun">=</span><span class="pln"> outFormat</span><span class="pun">.</span><span class="pln">getInteger</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_SAMPLE_RATE</span><span class="pun">);</span><span class="pln">

                            </span><span class="kwd">int</span><span class="pln"> newChannelType </span><span class="pun">=</span><span class="pln"> channelType</span><span class="pun">;</span><span class="pln">
                            </span><span class="kwd">int</span><span class="pln"> newChannelCount </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
                            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">outFormat</span><span class="pun">.</span><span class="pln">containsKey</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_CHANNEL_COUNT</span><span class="pun">))</span><span class="pln">
                            </span><span class="pun">{</span><span class="pln">
                                newChannelCount </span><span class="pun">=</span><span class="pln"> outFormat</span><span class="pun">.</span><span class="pln">getInteger</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_CHANNEL_COUNT</span><span class="pun">);</span><span class="pln">
                                newChannelType </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AudioFormat</span><span class="pun">.</span><span class="pln">CHANNEL_OUT_DEFAULT</span><span class="pun">;</span><span class="pln">
                                </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">newChannelCount </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
                                    newChannelType </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AudioFormat</span><span class="pun">.</span><span class="pln">CHANNEL_OUT_MONO</span><span class="pun">;</span><span class="pln">
                                </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">newChannelCount </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
                                    newChannelType </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AudioFormat</span><span class="pun">.</span><span class="pln">CHANNEL_OUT_STEREO</span><span class="pun">;</span><span class="pln">
                            </span><span class="pun">}</span><span class="pln">

                            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">newSampleRate </span><span class="pun">!=</span><span class="pln"> sampleRate </span><span class="pun">||</span><span class="pln"> newChannelType </span><span class="pun">!=</span><span class="pln"> channelType</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">w</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - reset _AudioTrack"</span><span class="pun">);</span><span class="pln">
                                </span><span class="typ">_AudioTrack</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln">
                                channelType </span><span class="pun">=</span><span class="pln"> newChannelType</span><span class="pun">;</span><span class="pln">
                                sampleRate </span><span class="pun">=</span><span class="pln"> newSampleRate</span><span class="pun">;</span><span class="pln">
                                </span><span class="typ">_AudioTrack</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AudioTrack</span><span class="pun">(</span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">STREAM_MUSIC</span><span class="pun">,</span><span class="pln"> sampleRate</span><span class="pun">,</span><span class="pln">
                                        channelType</span><span class="pun">,</span><span class="pln">
                                        bitRateMode</span><span class="pun">,</span><span class="pln">
                                        threadInfo</span><span class="pun">.</span><span class="pln">bufferSize</span><span class="pun">(),</span><span class="pln">
                                        TRACK_MODE</span><span class="pun">);</span><span class="pln">
                                </span><span class="typ">_AudioTrack</span><span class="pun">.</span><span class="pln">setStereoVolume</span><span class="pun">(</span><span class="pln">threadInfo</span><span class="pun">.</span><span class="pln">dataLeftVolume</span><span class="pun">(),</span><span class="pln"> threadInfo</span><span class="pun">.</span><span class="pln">dataRightVolume</span><span class="pun">());</span><span class="pln">
                                framesPerSample </span><span class="pun">=</span><span class="pln"> newChannelCount </span><span class="pun">*</span><span class="pln"> getBytesPerSample</span><span class="pun">(</span><span class="pln">bitRateMode</span><span class="pun">);</span><span class="pln">
                            </span><span class="pun">}</span><span class="pln">

                            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">outFormat</span><span class="pun">.</span><span class="pln">containsKey</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_DURATION</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                                threadInfo</span><span class="pun">.</span><span class="pln">duration</span><span class="pun">(</span><span class="pln">format</span><span class="pun">.</span><span class="pln">getLong</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_DURATION</span><span class="pun">));</span><span class="pln">
                            </span><span class="pun">}</span><span class="pln">
                        </span><span class="pun">}</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">

                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - stop and release codec"</span><span class="pun">);</span><span class="pln">
                codec</span><span class="pun">.</span><span class="pln">stop</span><span class="pun">();</span><span class="pln">
                codec</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln">

                loop </span><span class="pun">=</span><span class="pln"> threadInfo</span><span class="pun">.</span><span class="pln">looping</span><span class="pun">();</span><span class="pln">
                </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">loop</span><span class="pun">)</span><span class="pln">
                    </span><span class="kwd">continue</span><span class="pun">;</span><span class="pln">

                </span><span class="com">//we're about to break,</span><span class="pln">
                </span><span class="com">//make sure the track and extractor are released</span><span class="pln">
                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - about to break naturally"</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pun">(</span><span class="typ">_AudioTrack</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">){</span><span class="pln">
                    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - release _AudioTrack and _MediaExtractor"</span><span class="pun">);</span><span class="pln">
                    </span><span class="typ">_AudioTrack</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln">
                    </span><span class="typ">_MediaExtractor</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln">
                    </span><span class="typ">_AudioTrack</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
                    threadInfo</span><span class="pun">.</span><span class="pln">released</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">

                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"thread - onCompletion"</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">completionListener </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln">
                    completionListener</span><span class="pun">.</span><span class="pln">onCompletion</span><span class="pun">(</span><span class="typ">BosonPlayer</span><span class="pun">.</span><span class="kwd">this</span><span class="pun">);</span><span class="pln">

            </span><span class="pun">}</span><span class="pln">

        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">catch</span><span class="pun">(</span><span class="typ">IOException</span><span class="pln"> ioe</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            ioe</span><span class="pun">.</span><span class="pln">printStackTrace</span><span class="pun">();</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">errorListener </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln">
                errorListener</span><span class="pun">.</span><span class="pln">onError</span><span class="pun">(</span><span class="typ">BosonPlayer</span><span class="pun">.</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">catch</span><span class="pun">(</span><span class="typ">Exception</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            e</span><span class="pun">.</span><span class="pln">printStackTrace</span><span class="pun">();</span><span class="pln">
            </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">e</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"unhandled exception"</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">errorListener </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln">
                errorListener</span><span class="pun">.</span><span class="pln">onError</span><span class="pun">(</span><span class="typ">BosonPlayer</span><span class="pun">.</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 </span></pre>
			</div>

		</div>



						<!-- 1. example number -->
		<div style="margin:20px 2px; color:#424345; font-weight:bold;">Example 3</div>

		<div class="examplebox">

			<!-- 2. description -->
			<div class="exampleboxheader">
				<table width="100%">

					<tbody><tr>

						<td width="85%" style="padding: 2px; font-size:14px;line-height: 25px;">
							Project: <span style="font-style:italic;">ViPhone-master</span>
							<!--File:  <span style="font-style:italic;">/app/src/main/java/org/linphone/mediastream/AACFilter.java</span>-->
							<a href="http://www.programcreek.com/java-api-examples/index.php?source_dir=ViPhone-master/app/src/main/java/org/linphone/mediastream/AACFilter.java">
								<span style="font-style:italic;">View Source</span>
							</a>
						</td>

						<td width="8%" align="right" style="padding-right:5px; font-size:14px;">

								<span class="vote click_button" id="821631==android.media.MediaCodec" data-hasqtip="4">
									<!--<img alt="vote" src="./includes/images/like.png" width="25"/>-->
									Vote up
								</span>
						</td>

						<td width="10%" align="right" style="padding-right:5px; font-size:12px;">
							<span id="821631votes">6</span>
							votes
						</td>
					</tr>
				</tbody></table>




			</div>


			<!-- 3. code -->
			<div class="exampleboxbody">
				<pre class="prettyprint"><span class="kwd">static</span><span class="pln"> </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> dequeueData</span><span class="pun">(</span><span class="typ">MediaCodec</span><span class="pln"> codec</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ByteBuffer</span><span class="pun">[]</span><span class="pln"> ouputBuffers</span><span class="pun">,</span><span class="pln"> </span><span class="typ">BufferInfo</span><span class="pln"> bufferInfo</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> pcmbufPollCount </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">pcmbufPollCount </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> decBufIdx </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="highlight"><span class="pln">dequeueOutputBuffer</span></span><span class="pun">(</span><span class="pln">bufferInfo</span><span class="pun">,</span><span class="pln"> </span><span class="lit">100</span><span class="pun">);</span><span class="pln">

		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">decBufIdx </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">b</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&lt;</span><span class="pln"> bufferInfo</span><span class="pun">.</span><span class="pln">size</span><span class="pun">)</span><span class="pln">
				</span><span class="typ">Log</span><span class="pun">.</span><span class="pln">e</span><span class="pun">(</span><span class="str">"array is too small "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">length </span><span class="pun">+</span><span class="pln"> </span><span class="str">" &lt; "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> bufferInfo</span><span class="pun">.</span><span class="pln">size</span><span class="pun">);</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bufferInfo</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">BUFFER_FLAG_CODEC_CONFIG</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				</span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="str">"JUST READ MediaCodec.BUFFER_FLAG_CODEC_CONFIG buffer"</span><span class="pun">);</span><span class="pln">

			</span><span class="pun">}</span><span class="pln">
			ouputBuffers</span><span class="pun">[</span><span class="pln">decBufIdx</span><span class="pun">].</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">b</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> bufferInfo</span><span class="pun">.</span><span class="pln">size</span><span class="pun">);</span><span class="pln">
			ouputBuffers</span><span class="pun">[</span><span class="pln">decBufIdx</span><span class="pun">].</span><span class="pln">position</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">

			codec</span><span class="pun">.</span><span class="pln">releaseOutputBuffer</span><span class="pun">(</span><span class="pln">decBufIdx</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> bufferInfo</span><span class="pun">.</span><span class="pln">size</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">decBufIdx </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_BUFFERS_CHANGED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">return</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_BUFFERS_CHANGED</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">decBufIdx </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_FORMAT_CHANGED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="str">"MediaCodec.INFO_OUTPUT_FORMAT_CHANGED"</span><span class="pun">);</span><span class="pln">
			</span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="str">"CHANNEL_COUNT: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">getOutputFormat</span><span class="pun">().</span><span class="pln">getInteger</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_CHANNEL_COUNT</span><span class="pun">));</span><span class="pln">
			</span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="str">"SAMPLE_RATE: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">getOutputFormat</span><span class="pun">().</span><span class="pln">getInteger</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_SAMPLE_RATE</span><span class="pun">));</span><span class="pln">

		</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">decBufIdx </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_TRY_AGAIN_LATER</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="com">// Log.i("MediaCodec.INFO_TRY_AGAIN_LATER");</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
		</span><span class="pun">++</span><span class="pln">pcmbufPollCount</span><span class="pun">;</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 </span></pre>
			</div>

		</div>



				<script async="" data-rocketsrc="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" type="text/rocketscript" data-rocketoptimized="true"></script>
		<!-- java api examples -->
		<ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-5732630628268628" data-ad-slot="8058070175" data-adsbygoogle-status="done"><ins id="aswift_3_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent"><ins id="aswift_3_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent"><iframe width="728" height="90" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_3" name="aswift_3" style="left:0;position:absolute;top:0;" src="./Java Code Example_files/saved_resource(3).html"></iframe></ins></ins></ins>
		<script type="text/rocketscript" data-rocketoptimized="true">
		(adsbygoogle = window.adsbygoogle || []).push({});
		</script>



						<!-- 1. example number -->
		<div style="margin:20px 2px; color:#424345; font-weight:bold;">Example 4</div>

		<div class="examplebox">

			<!-- 2. description -->
			<div class="exampleboxheader">
				<table width="100%">

					<tbody><tr>

						<td width="85%" style="padding: 2px; font-size:14px;line-height: 25px;">
							Project: <span style="font-style:italic;">VirtualFrontView-master</span>
							<!--File:  <span style="font-style:italic;">/libstreaming/src/net/majorkernelpanic/streaming/hw/EncoderDebugger.java</span>-->
							<a href="http://www.programcreek.com/java-api-examples/index.php?source_dir=VirtualFrontView-master/libstreaming/src/net/majorkernelpanic/streaming/hw/EncoderDebugger.java">
								<span style="font-style:italic;">View Source</span>
							</a>
						</td>

						<td width="8%" align="right" style="padding-right:5px; font-size:14px;">

								<span class="vote click_button" id="1269098==android.media.MediaCodec" data-hasqtip="5">
									<!--<img alt="vote" src="./includes/images/like.png" width="25"/>-->
									Vote up
								</span>
						</td>

						<td width="10%" align="right" style="padding-right:5px; font-size:12px;">
							<span id="1269098votes">6</span>
							votes
						</td>
					</tr>
				</tbody></table>




			</div>


			<!-- 3. code -->
			<div class="exampleboxbody">
				<pre class="prettyprint"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> flushMediaCodec</span><span class="pun">(</span><span class="typ">MediaCodec</span><span class="pln"> mc</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="typ">BufferInfo</span><span class="pln"> info </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BufferInfo</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index </span><span class="pun">!=</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_TRY_AGAIN_LATER</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		index </span><span class="pun">=</span><span class="pln"> mc</span><span class="pun">.</span><span class="highlight"><span class="pln">dequeueOutputBuffer</span></span><span class="pun">(</span><span class="pln">info</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1000000</span><span class="pun">/</span><span class="pln">FRAMERATE</span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index</span><span class="pun">&gt;=</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			mc</span><span class="pun">.</span><span class="pln">releaseOutputBuffer</span><span class="pun">(</span><span class="pln">index</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 </span></pre>
			</div>

		</div>



						<!-- 1. example number -->
		<div style="margin:20px 2px; color:#424345; font-weight:bold;">Example 5</div>

		<div class="examplebox">

			<!-- 2. description -->
			<div class="exampleboxheader">
				<table width="100%">

					<tbody><tr>

						<td width="85%" style="padding: 2px; font-size:14px;line-height: 25px;">
							Project: <span style="font-style:italic;">libstreaming-master</span>
							<!--File:  <span style="font-style:italic;">/src/net/majorkernelpanic/streaming/hw/EncoderDebugger.java</span>-->
							<a href="http://www.programcreek.com/java-api-examples/index.php?source_dir=libstreaming-master/src/net/majorkernelpanic/streaming/hw/EncoderDebugger.java">
								<span style="font-style:italic;">View Source</span>
							</a>
						</td>

						<td width="8%" align="right" style="padding-right:5px; font-size:14px;">

								<span class="vote click_button" id="2549573==android.media.MediaCodec" data-hasqtip="6">
									<!--<img alt="vote" src="./includes/images/like.png" width="25"/>-->
									Vote up
								</span>
						</td>

						<td width="10%" align="right" style="padding-right:5px; font-size:12px;">
							<span id="2549573votes">6</span>
							votes
						</td>
					</tr>
				</tbody></table>




			</div>


			<!-- 3. code -->
			<div class="exampleboxbody">
				<pre class="prettyprint"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> flushMediaCodec</span><span class="pun">(</span><span class="typ">MediaCodec</span><span class="pln"> mc</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="typ">BufferInfo</span><span class="pln"> info </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BufferInfo</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index </span><span class="pun">!=</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_TRY_AGAIN_LATER</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		index </span><span class="pun">=</span><span class="pln"> mc</span><span class="pun">.</span><span class="highlight"><span class="pln">dequeueOutputBuffer</span></span><span class="pun">(</span><span class="pln">info</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1000000</span><span class="pun">/</span><span class="pln">FRAMERATE</span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index</span><span class="pun">&gt;=</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			mc</span><span class="pun">.</span><span class="pln">releaseOutputBuffer</span><span class="pun">(</span><span class="pln">index</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 </span></pre>
			</div>

		</div>



						<!-- 1. example number -->
		<div style="margin:20px 2px; color:#424345; font-weight:bold;">Example 6</div>

		<div class="examplebox">

			<!-- 2. description -->
			<div class="exampleboxheader">
				<table width="100%">

					<tbody><tr>

						<td width="85%" style="padding: 2px; font-size:14px;line-height: 25px;">
							Project: <span style="font-style:italic;">sprinkler-master</span>
							<!--File:  <span style="font-style:italic;">/libstreaming/src/main/java/net/majorkernelpanic/streaming/hw/EncoderDebugger.java</span>-->
							<a href="http://www.programcreek.com/java-api-examples/index.php?source_dir=sprinkler-master/libstreaming/src/main/java/net/majorkernelpanic/streaming/hw/EncoderDebugger.java">
								<span style="font-style:italic;">View Source</span>
							</a>
						</td>

						<td width="8%" align="right" style="padding-right:5px; font-size:14px;">

								<span class="vote click_button" id="2646646==android.media.MediaCodec" data-hasqtip="7">
									<!--<img alt="vote" src="./includes/images/like.png" width="25"/>-->
									Vote up
								</span>
						</td>

						<td width="10%" align="right" style="padding-right:5px; font-size:12px;">
							<span id="2646646votes">6</span>
							votes
						</td>
					</tr>
				</tbody></table>




			</div>


			<!-- 3. code -->
			<div class="exampleboxbody">
				<pre class="prettyprint"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> flushMediaCodec</span><span class="pun">(</span><span class="typ">MediaCodec</span><span class="pln"> mc</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="typ">BufferInfo</span><span class="pln"> info </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BufferInfo</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index </span><span class="pun">!=</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_TRY_AGAIN_LATER</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		index </span><span class="pun">=</span><span class="pln"> mc</span><span class="pun">.</span><span class="highlight"><span class="pln">dequeueOutputBuffer</span></span><span class="pun">(</span><span class="pln">info</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1000000</span><span class="pun">/</span><span class="pln">FRAMERATE</span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index</span><span class="pun">&gt;=</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			mc</span><span class="pun">.</span><span class="pln">releaseOutputBuffer</span><span class="pun">(</span><span class="pln">index</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 </span></pre>
			</div>

		</div>



						<!-- 1. example number -->
		<div style="margin:20px 2px; color:#424345; font-weight:bold;">Example 7</div>

		<div class="examplebox">

			<!-- 2. description -->
			<div class="exampleboxheader">
				<table width="100%">

					<tbody><tr>

						<td width="85%" style="padding: 2px; font-size:14px;line-height: 25px;">
							Project: <span style="font-style:italic;">ScreenRecoder-master</span>
							<!--File:  <span style="font-style:italic;">/src/com/a30corner/screenrecoder/ScreenRecoder.java</span>-->
							<a href="http://www.programcreek.com/java-api-examples/index.php?source_dir=ScreenRecoder-master/src/com/a30corner/screenrecoder/ScreenRecoder.java">
								<span style="font-style:italic;">View Source</span>
							</a>
						</td>

						<td width="8%" align="right" style="padding-right:5px; font-size:14px;">

								<span class="vote click_button" id="2977760==android.media.MediaCodec" data-hasqtip="8">
									<!--<img alt="vote" src="./includes/images/like.png" width="25"/>-->
									Vote up
								</span>
						</td>

						<td width="10%" align="right" style="padding-right:5px; font-size:12px;">
							<span id="2977760votes">6</span>
							votes
						</td>
					</tr>
				</tbody></table>




			</div>


			<!-- 3. code -->
			<div class="exampleboxbody">
				<pre class="prettyprint"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> stream</span><span class="pun">(</span><span class="typ">MediaCodec</span><span class="pln"> codec</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="typ">BufferInfo</span><span class="pln"> info </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BufferInfo</span><span class="pun">();</span><span class="pln">
	</span><span class="typ">ByteBuffer</span><span class="pun">[]</span><span class="pln"> buffers </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">

	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">mQuitting</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		</span><span class="kwd">int</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="highlight"><span class="pln">dequeueOutputBuffer</span></span><span class="pun">(</span><span class="pln">info</span><span class="pun">,</span><span class="pln"> TIMEOUT_USEC</span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">buffers </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				buffers </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">getOutputBuffers</span><span class="pun">();</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">

			</span><span class="typ">ByteBuffer</span><span class="pln"> buffer </span><span class="pun">=</span><span class="pln"> buffers</span><span class="pun">[</span><span class="pln">index</span><span class="pun">];</span><span class="pln">
			buffer</span><span class="pun">.</span><span class="pln">limit</span><span class="pun">(</span><span class="pln">info</span><span class="pun">.</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> info</span><span class="pun">.</span><span class="pln">size</span><span class="pun">);</span><span class="pln">
			buffer</span><span class="pun">.</span><span class="pln">position</span><span class="pun">(</span><span class="pln">info</span><span class="pun">.</span><span class="pln">offset</span><span class="pun">);</span><span class="pln">

			muxer</span><span class="pun">.</span><span class="pln">writeSampleData</span><span class="pun">(</span><span class="pln">videoTrackIndex</span><span class="pun">,</span><span class="pln"> buffer</span><span class="pun">,</span><span class="pln"> info</span><span class="pun">);</span><span class="pln">

			codec</span><span class="pun">.</span><span class="pln">releaseOutputBuffer</span><span class="pun">(</span><span class="pln">index</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_FORMAT_CHANGED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mMuxerStarted</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
				</span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RuntimeException</span><span class="pun">(</span><span class="str">"format changed twice"</span><span class="pun">);</span><span class="pln">
			</span><span class="pun">}</span><span class="pln">
			
			</span><span class="typ">MediaFormat</span><span class="pln"> newFormat </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">getOutputFormat</span><span class="pun">();</span><span class="pln">

			</span><span class="com">// now that we have the Magic Goodies, start the muxer</span><span class="pln">
			videoTrackIndex </span><span class="pun">=</span><span class="pln"> muxer</span><span class="pun">.</span><span class="pln">addTrack</span><span class="pun">(</span><span class="pln">newFormat</span><span class="pun">);</span><span class="pln">
			muxer</span><span class="pun">.</span><span class="pln">start</span><span class="pun">();</span><span class="pln">

			mMuxerStarted </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">

			buffers </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_BUFFERS_CHANGED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			buffers </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
		</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_TRY_AGAIN_LATER</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			</span><span class="typ">Log</span><span class="pun">.</span><span class="pln">e</span><span class="pun">(</span><span class="str">"sam"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Codec dequeue buffer timed out."</span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">

	muxer</span><span class="pun">.</span><span class="pln">stop</span><span class="pun">();</span><span class="pln">
	muxer</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 </span></pre>
			</div>

		</div>



						<!-- 1. example number -->
		<div style="margin:20px 2px; color:#424345; font-weight:bold;">Example 8</div>

		<div class="examplebox">

			<!-- 2. description -->
			<div class="exampleboxheader">
				<table width="100%">

					<tbody><tr>

						<td width="85%" style="padding: 2px; font-size:14px;line-height: 25px;">
							Project: <span style="font-style:italic;">dronekit-android-master</span>
							<!--File:  <span style="font-style:italic;">/ServiceApp/src/org/droidplanner/services/android/utils/video/MediaCodecManager.java</span>-->
							<a href="http://www.programcreek.com/java-api-examples/index.php?source_dir=dronekit-android-master/ServiceApp/src/org/droidplanner/services/android/utils/video/MediaCodecManager.java">
								<span style="font-style:italic;">View Source</span>
							</a>
						</td>

						<td width="8%" align="right" style="padding-right:5px; font-size:14px;">

								<span class="vote click_button" id="3632846==android.media.MediaCodec" data-hasqtip="9">
									<!--<img alt="vote" src="./includes/images/like.png" width="25"/>-->
									Vote up
								</span>
						</td>

						<td width="10%" align="right" style="padding-right:5px; font-size:12px;">
							<span id="3632846votes">6</span>
							votes
						</td>
					</tr>
				</tbody></table>




			</div>


			<!-- 3. code -->
			<div class="exampleboxbody">
				<pre class="prettyprint"><span class="lit">@Override</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pln"> mediaCodec </span><span class="pun">=</span><span class="pln"> mediaCodecRef</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mediaCodec </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IllegalStateException</span><span class="pun">(</span><span class="str">"Start decoding hasn't been called yet."</span><span class="pun">);</span><span class="pln">

    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Starting dequeue codec runner."</span><span class="pun">);</span><span class="pln">

    </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="typ">BufferInfo</span><span class="pln"> info </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="typ">BufferInfo</span><span class="pun">();</span><span class="pln">
    decodedFirstFrame</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">boolean</span><span class="pln"> doRender</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">boolean</span><span class="pln"> continueDequeue </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">continueDequeue</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> mediaCodec</span><span class="pun">.</span><span class="highlight"><span class="pln">dequeueOutputBuffer</span></span><span class="pun">(</span><span class="pln">info</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                doRender </span><span class="pun">=</span><span class="pln"> info</span><span class="pun">.</span><span class="pln">size </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
                mediaCodec</span><span class="pun">.</span><span class="pln">releaseOutputBuffer</span><span class="pun">(</span><span class="pln">index</span><span class="pun">,</span><span class="pln"> doRender</span><span class="pun">);</span><span class="pln">

                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">decodedFirstFrame</span><span class="pun">.</span><span class="pln">compareAndSet</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    notifyDecodingStarted</span><span class="pun">();</span><span class="pln">
                    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Received first decoded frame of size "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> info</span><span class="pun">.</span><span class="pln">size</span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">

                continueDequeue </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">info</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">&amp;</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">BUFFER_FLAG_END_OF_STREAM</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">continueDequeue</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Received end of stream flag."</span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IllegalStateException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(!</span><span class="pln">isInterrupted</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">e</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Decoding error!"</span><span class="pun">,</span><span class="pln"> e</span><span class="pun">);</span><span class="pln">
            notifyDecodingError</span><span class="pun">();</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">finally</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">isInterrupted</span><span class="pun">())</span><span class="pln">
            notifyDecodingEnded</span><span class="pun">();</span><span class="pln">
        </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Stopping dequeue codec runner."</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 </span></pre>
			</div>

		</div>



						<!-- 1. example number -->
		<div style="margin:20px 2px; color:#424345; font-weight:bold;">Example 9</div>

		<div class="examplebox">

			<!-- 2. description -->
			<div class="exampleboxheader">
				<table width="100%">

					<tbody><tr>

						<td width="85%" style="padding: 2px; font-size:14px;line-height: 25px;">
							Project: <span style="font-style:italic;">Sing-it-now-master</span>
							<!--File:  <span style="font-style:italic;">/Android Client/libstreaming/src/main/java/net/majorkernelpanic/streaming/hw/EncoderDebugger.java</span>-->
							<a href="http://www.programcreek.com/java-api-examples/index.php?source_dir=Sing-it-now-master/Android%20Client/libstreaming/src/main/java/net/majorkernelpanic/streaming/hw/EncoderDebugger.java">
								<span style="font-style:italic;">View Source</span>
							</a>
						</td>

						<td width="8%" align="right" style="padding-right:5px; font-size:14px;">

								<span class="vote click_button" id="3736574==android.media.MediaCodec" data-hasqtip="10">
									<!--<img alt="vote" src="./includes/images/like.png" width="25"/>-->
									Vote up
								</span>
						</td>

						<td width="10%" align="right" style="padding-right:5px; font-size:12px;">
							<span id="3736574votes">6</span>
							votes
						</td>
					</tr>
				</tbody></table>




			</div>


			<!-- 3. code -->
			<div class="exampleboxbody">
				<pre class="prettyprint"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> flushMediaCodec</span><span class="pun">(</span><span class="typ">MediaCodec</span><span class="pln"> mc</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="typ">BufferInfo</span><span class="pln"> info </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BufferInfo</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index </span><span class="pun">!=</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_TRY_AGAIN_LATER</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		index </span><span class="pun">=</span><span class="pln"> mc</span><span class="pun">.</span><span class="highlight"><span class="pln">dequeueOutputBuffer</span></span><span class="pun">(</span><span class="pln">info</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1000000</span><span class="pun">/</span><span class="pln">FRAMERATE</span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index</span><span class="pun">&gt;=</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			mc</span><span class="pun">.</span><span class="pln">releaseOutputBuffer</span><span class="pun">(</span><span class="pln">index</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 </span></pre>
			</div>

		</div>



						<!-- 1. example number -->
		<div style="margin:20px 2px; color:#424345; font-weight:bold;">Example 10</div>

		<div class="examplebox">

			<!-- 2. description -->
			<div class="exampleboxheader">
				<table width="100%">

					<tbody><tr>

						<td width="85%" style="padding: 2px; font-size:14px;line-height: 25px;">
							Project: <span style="font-style:italic;">android-sdk-sources-for-api-level-23-master</span>
							<!--File:  <span style="font-style:italic;">/com/android/accessorydisplay/source/DisplaySourceService.java</span>-->
							<a href="http://www.programcreek.com/java-api-examples/index.php?source_dir=android-sdk-sources-for-api-level-23-master/com/android/accessorydisplay/source/DisplaySourceService.java">
								<span style="font-style:italic;">View Source</span>
							</a>
						</td>

						<td width="8%" align="right" style="padding-right:5px; font-size:14px;">

								<span class="vote click_button" id="3807865==android.media.MediaCodec" data-hasqtip="11">
									<!--<img alt="vote" src="./includes/images/like.png" width="25"/>-->
									Vote up
								</span>
						</td>

						<td width="10%" align="right" style="padding-right:5px; font-size:12px;">
							<span id="3807865votes">6</span>
							votes
						</td>
					</tr>
				</tbody></table>




			</div>


			<!-- 3. code -->
			<div class="exampleboxbody">
				<pre class="prettyprint"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> stream</span><span class="pun">(</span><span class="typ">MediaCodec</span><span class="pln"> codec</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">BufferInfo</span><span class="pln"> info </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BufferInfo</span><span class="pun">();</span><span class="pln">
    </span><span class="typ">ByteBuffer</span><span class="pun">[]</span><span class="pln"> buffers </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">mQuitting</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="highlight"><span class="pln">dequeueOutputBuffer</span></span><span class="pun">(</span><span class="pln">info</span><span class="pun">,</span><span class="pln"> TIMEOUT_USEC</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">buffers </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                buffers </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">getOutputBuffers</span><span class="pun">();</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">

            </span><span class="typ">ByteBuffer</span><span class="pln"> buffer </span><span class="pun">=</span><span class="pln"> buffers</span><span class="pun">[</span><span class="pln">index</span><span class="pun">];</span><span class="pln">
            buffer</span><span class="pun">.</span><span class="pln">limit</span><span class="pun">(</span><span class="pln">info</span><span class="pun">.</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> info</span><span class="pun">.</span><span class="pln">size</span><span class="pun">);</span><span class="pln">
            buffer</span><span class="pun">.</span><span class="pln">position</span><span class="pun">(</span><span class="pln">info</span><span class="pun">.</span><span class="pln">offset</span><span class="pun">);</span><span class="pln">

            getTransport</span><span class="pun">().</span><span class="pln">sendMessage</span><span class="pun">(</span><span class="typ">Protocol</span><span class="pun">.</span><span class="typ">DisplaySinkService</span><span class="pun">.</span><span class="pln">ID</span><span class="pun">,</span><span class="pln">
                    </span><span class="typ">Protocol</span><span class="pun">.</span><span class="typ">DisplaySinkService</span><span class="pun">.</span><span class="pln">MSG_CONTENT</span><span class="pun">,</span><span class="pln"> buffer</span><span class="pun">);</span><span class="pln">
            codec</span><span class="pun">.</span><span class="pln">releaseOutputBuffer</span><span class="pun">(</span><span class="pln">index</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_BUFFERS_CHANGED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            buffers </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_TRY_AGAIN_LATER</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            getLogger</span><span class="pun">().</span><span class="pln">log</span><span class="pun">(</span><span class="str">"Codec dequeue buffer timed out."</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 </span></pre>
			</div>

		</div>



						<!-- 1. example number -->
		<div style="margin:20px 2px; color:#424345; font-weight:bold;">Example 11</div>

		<div class="examplebox">

			<!-- 2. description -->
			<div class="exampleboxheader">
				<table width="100%">

					<tbody><tr>

						<td width="85%" style="padding: 2px; font-size:14px;line-height: 25px;">
							Project: <span style="font-style:italic;">Flyver-Apps-master</span>
							<!--File:  <span style="font-style:italic;">/HelloFlyver/libstreaming/src/main/java/net/majorkernelpanic/streaming/hw/EncoderDebugger.java</span>-->
							<a href="http://www.programcreek.com/java-api-examples/index.php?source_dir=Flyver-Apps-master/HelloFlyver/libstreaming/src/main/java/net/majorkernelpanic/streaming/hw/EncoderDebugger.java">
								<span style="font-style:italic;">View Source</span>
							</a>
						</td>

						<td width="8%" align="right" style="padding-right:5px; font-size:14px;">

								<span class="vote click_button" id="4807192==android.media.MediaCodec" data-hasqtip="12">
									<!--<img alt="vote" src="./includes/images/like.png" width="25"/>-->
									Vote up
								</span>
						</td>

						<td width="10%" align="right" style="padding-right:5px; font-size:12px;">
							<span id="4807192votes">6</span>
							votes
						</td>
					</tr>
				</tbody></table>




			</div>


			<!-- 3. code -->
			<div class="exampleboxbody">
				<pre class="prettyprint"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> flushMediaCodec</span><span class="pun">(</span><span class="typ">MediaCodec</span><span class="pln"> mc</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="kwd">int</span><span class="pln"> index </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
	</span><span class="typ">BufferInfo</span><span class="pln"> info </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BufferInfo</span><span class="pun">();</span><span class="pln">
	</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index </span><span class="pun">!=</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_TRY_AGAIN_LATER</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		index </span><span class="pun">=</span><span class="pln"> mc</span><span class="pun">.</span><span class="highlight"><span class="pln">dequeueOutputBuffer</span></span><span class="pun">(</span><span class="pln">info</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1000000</span><span class="pun">/</span><span class="pln">FRAMERATE</span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">index</span><span class="pun">&gt;=</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
			mc</span><span class="pun">.</span><span class="pln">releaseOutputBuffer</span><span class="pun">(</span><span class="pln">index</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
		</span><span class="pun">}</span><span class="pln">
	</span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 </span></pre>
			</div>

		</div>



						<!-- 1. example number -->
		<div style="margin:20px 2px; color:#424345; font-weight:bold;">Example 12</div>

		<div class="examplebox">

			<!-- 2. description -->
			<div class="exampleboxheader">
				<table width="100%">

					<tbody><tr>

						<td width="85%" style="padding: 2px; font-size:14px;line-height: 25px;">
							Project: <span style="font-style:italic;">camPreviewRecord-master</span>
							<!--File:  <span style="font-style:italic;">/app/src/main/java/com/tylerjroach/camPreviewSave/VideoEncoderCore.java</span>-->
							<a href="http://www.programcreek.com/java-api-examples/index.php?source_dir=camPreviewRecord-master/app/src/main/java/com/tylerjroach/camPreviewSave/VideoEncoderCore.java">
								<span style="font-style:italic;">View Source</span>
							</a>
						</td>

						<td width="8%" align="right" style="padding-right:5px; font-size:14px;">

								<span class="vote click_button" id="903955==android.media.MediaCodec" data-hasqtip="13">
									<!--<img alt="vote" src="./includes/images/like.png" width="25"/>-->
									Vote up
								</span>
						</td>

						<td width="10%" align="right" style="padding-right:5px; font-size:12px;">
							<span id="903955votes">5</span>
							votes
						</td>
					</tr>
				</tbody></table>




			</div>


			<!-- 3. code -->
			<div class="exampleboxbody">
				<pre class="prettyprint"><span class="com">/**
 * Extracts all pending data from the encoder and forwards it to the muxer.
 * &lt;p&gt;
 * If endOfStream is not set, this returns when there is no more data to drain.  If it
 * is set, we send EOS to the encoder, and then iterate until we see EOS on the output.
 * Calling this with endOfStream set should be done once, right before stopping the muxer.
 * &lt;p&gt;
 * We're just using the muxer to get a .mp4 file (instead of a raw H.264 stream).  We're
 * not recording audio.
 */</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> drainEncoder</span><span class="pun">(</span><span class="typ">MediaCodec</span><span class="pln"> encoder</span><span class="pun">,</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="typ">BufferInfo</span><span class="pln"> bufferInfo</span><span class="pun">,</span><span class="pln"> </span><span class="typ">TrackInfo</span><span class="pln"> trackInfo</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> endOfStream</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> TIMEOUT_USEC </span><span class="pun">=</span><span class="pln"> </span><span class="lit">100</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//TODO: Get Muxer from trackInfo</span><span class="pln">
    </span><span class="typ">MediaMuxerWrapper</span><span class="pln"> muxerWrapper </span><span class="pun">=</span><span class="pln"> trackInfo</span><span class="pun">.</span><span class="pln">muxerWrapper</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">VERBOSE</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"drain"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">((</span><span class="pln">encoder </span><span class="pun">==</span><span class="pln"> mVideoEncoder</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">"Video"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"Audio"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">"Encoder("</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> endOfStream </span><span class="pun">+</span><span class="pln"> </span><span class="str">")"</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">endOfStream </span><span class="pun">&amp;&amp;</span><span class="pln"> encoder </span><span class="pun">==</span><span class="pln"> mVideoEncoder</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">VERBOSE</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"sending EOS to "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">((</span><span class="pln">encoder </span><span class="pun">==</span><span class="pln"> mVideoEncoder</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">"video"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">"audio"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">" encoder"</span><span class="pun">);</span><span class="pln">
        encoder</span><span class="pun">.</span><span class="pln">signalEndOfInputStream</span><span class="pun">();</span><span class="pln">
        eosSentToVideoEncoder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="com">//testing</span><span class="pln">
    </span><span class="typ">ByteBuffer</span><span class="pun">[]</span><span class="pln"> encoderOutputBuffers </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">.</span><span class="pln">getOutputBuffers</span><span class="pun">();</span><span class="pln">

    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> encoderStatus </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">.</span><span class="highlight"><span class="pln">dequeueOutputBuffer</span></span><span class="pun">(</span><span class="pln">bufferInfo</span><span class="pun">,</span><span class="pln"> TIMEOUT_USEC</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">encoderStatus </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_TRY_AGAIN_LATER</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="com">// no output available yet</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">endOfStream</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">VERBOSE</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"no output available. aborting drain"</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">      </span><span class="com">// out of while</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">VERBOSE</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"no output available, spinning to await EOS"</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">encoderStatus </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_BUFFERS_CHANGED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="com">// not expected for an encoder</span><span class="pln">
            encoderOutputBuffers </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">.</span><span class="pln">getOutputBuffers</span><span class="pun">();</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">encoderStatus </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_FORMAT_CHANGED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="com">// should happen before receiving buffers, and should only happen once</span><span class="pln">

            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">muxerWrapper</span><span class="pun">.</span><span class="pln">started</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="com">//Log.e(TAG, "format changed after muxer start! Can we ignore?");</span><span class="pln">
                </span><span class="com">//throw new RuntimeException("format changed after muxer start");</span><span class="pln">
            </span><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span><span class="pln">
                </span><span class="typ">MediaFormat</span><span class="pln"> newFormat </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">.</span><span class="pln">getOutputFormat</span><span class="pun">();</span><span class="pln">
                </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">encoder </span><span class="pun">==</span><span class="pln"> mVideoEncoder</span><span class="pun">)</span><span class="pln">
                    mVideoOutputFormat </span><span class="pun">=</span><span class="pln"> newFormat</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">encoder </span><span class="pun">==</span><span class="pln"> mAudioEncoder</span><span class="pun">)</span><span class="pln">
                    mAudioOutputFormat </span><span class="pun">=</span><span class="pln"> newFormat</span><span class="pun">;</span><span class="pln">

                </span><span class="com">// now that we have the Magic Goodies, start the muxer</span><span class="pln">
                trackInfo</span><span class="pun">.</span><span class="pln">index </span><span class="pun">=</span><span class="pln"> muxerWrapper</span><span class="pun">.</span><span class="pln">addTrack</span><span class="pun">(</span><span class="pln">newFormat</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pun">(!</span><span class="pln">muxerWrapper</span><span class="pun">.</span><span class="pln">allTracksAdded</span><span class="pun">())</span><span class="pln">
                    </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">  </span><span class="com">// Allow both encoders to send output format changed before attempting to write samples</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">

        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">encoderStatus </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">w</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"unexpected result from encoder.</span><span class="highlight"><span class="str">dequeueOutputBuffer</span></span><span class="str">: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                    encoderStatus</span><span class="pun">);</span><span class="pln">
            </span><span class="com">// let's ignore it</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">ByteBuffer</span><span class="pln"> encodedData </span><span class="pun">=</span><span class="pln"> encoderOutputBuffers</span><span class="pun">[</span><span class="pln">encoderStatus</span><span class="pun">];</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">encodedData </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RuntimeException</span><span class="pun">(</span><span class="str">"encoderOutputBuffer "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> encoderStatus </span><span class="pun">+</span><span class="pln">
                        </span><span class="str">" was null"</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">

            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">bufferInfo</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">&amp;</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">BUFFER_FLAG_CODEC_CONFIG</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="com">// The codec config data was pulled out and fed to the muxer when we got</span><span class="pln">
                </span><span class="com">// the INFO_OUTPUT_FORMAT_CHANGED status.  Ignore it.</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">VERBOSE</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"ignoring BUFFER_FLAG_CODEC_CONFIG"</span><span class="pun">);</span><span class="pln">
                bufferInfo</span><span class="pun">.</span><span class="pln">size </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">


            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bufferInfo</span><span class="pun">.</span><span class="pln">size </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">trackInfo</span><span class="pun">.</span><span class="pln">muxerWrapper</span><span class="pun">.</span><span class="pln">started</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">e</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Muxer not started. dropping "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">((</span><span class="pln">encoder </span><span class="pun">==</span><span class="pln"> mVideoEncoder</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">" video"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">" audio"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">" frames"</span><span class="pun">);</span><span class="pln">
                    </span><span class="com">//throw new RuntimeException("muxer hasn't started");</span><span class="pln">
                </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pun">{</span><span class="pln">
                    </span><span class="com">// adjust the ByteBuffer values to match BufferInfo (not needed?)</span><span class="pln">
                    encodedData</span><span class="pun">.</span><span class="pln">position</span><span class="pun">(</span><span class="pln">bufferInfo</span><span class="pun">.</span><span class="pln">offset</span><span class="pun">);</span><span class="pln">
                    encodedData</span><span class="pun">.</span><span class="pln">limit</span><span class="pun">(</span><span class="pln">bufferInfo</span><span class="pun">.</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> bufferInfo</span><span class="pun">.</span><span class="pln">size</span><span class="pun">);</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">encoder </span><span class="pun">==</span><span class="pln"> mAudioEncoder</span><span class="pun">){</span><span class="pln">
                        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">bufferInfo</span><span class="pun">.</span><span class="pln">presentationTimeUs </span><span class="pun">&lt;</span><span class="pln"> lastEncodedAudioTimeStamp</span><span class="pun">)</span><span class="pln">
                            bufferInfo</span><span class="pun">.</span><span class="pln">presentationTimeUs </span><span class="pun">=</span><span class="pln"> lastEncodedAudioTimeStamp </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">23219</span><span class="pun">;</span><span class="pln"> </span><span class="com">// Magical AAC encoded frame time</span><span class="pln">
                        lastEncodedAudioTimeStamp </span><span class="pun">=</span><span class="pln"> bufferInfo</span><span class="pun">.</span><span class="pln">presentationTimeUs</span><span class="pun">;</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">bufferInfo</span><span class="pun">.</span><span class="pln">presentationTimeUs </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">){</span><span class="pln">
                        bufferInfo</span><span class="pun">.</span><span class="pln">presentationTimeUs </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                    muxerWrapper</span><span class="pun">.</span><span class="pln">muxer</span><span class="pun">.</span><span class="pln">writeSampleData</span><span class="pun">(</span><span class="pln">trackInfo</span><span class="pun">.</span><span class="pln">index</span><span class="pun">,</span><span class="pln"> encodedData</span><span class="pun">,</span><span class="pln"> bufferInfo</span><span class="pun">);</span><span class="pln">

                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">VERBOSE</span><span class="pun">)</span><span class="pln">
                        </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"sent "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> bufferInfo</span><span class="pun">.</span><span class="pln">size </span><span class="pun">+</span><span class="pln"> </span><span class="pun">((</span><span class="pln">encoder </span><span class="pun">==</span><span class="pln"> mVideoEncoder</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">" video"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">" audio"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">" bytes to muxer with pts "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> bufferInfo</span><span class="pun">.</span><span class="pln">presentationTimeUs</span><span class="pun">);</span><span class="pln">

                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">

            encoder</span><span class="pun">.</span><span class="pln">releaseOutputBuffer</span><span class="pun">(</span><span class="pln">encoderStatus</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">

            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">bufferInfo</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">&amp;</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">BUFFER_FLAG_END_OF_STREAM</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">endOfStream</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">w</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"reached end of stream unexpectedly"</span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    muxerWrapper</span><span class="pun">.</span><span class="pln">finishTrack</span><span class="pun">();</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">VERBOSE</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"end of "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">((</span><span class="pln">encoder </span><span class="pun">==</span><span class="pln"> mVideoEncoder</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">" video"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">" audio"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">" stream reached. "</span><span class="pun">);</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pun">(!</span><span class="pln">fullStopReceived</span><span class="pun">){</span><span class="pln">
                    </span><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span><span class="pln">

                        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">encoder </span><span class="pun">==</span><span class="pln"> mVideoEncoder</span><span class="pun">){</span><span class="pln">
                            </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Stopping and releasing video encoder"</span><span class="pun">);</span><span class="pln">
                            stopAndReleaseVideoEncoder</span><span class="pun">();</span><span class="pln">
                        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">encoder </span><span class="pun">==</span><span class="pln"> mAudioEncoder</span><span class="pun">){</span><span class="pln">
                            </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Stopping and releasing audio encoder"</span><span class="pun">);</span><span class="pln">
                            stopAndReleaseAudioEncoder</span><span class="pun">();</span><span class="pln">
                        </span><span class="pun">}</span><span class="pln">
                        </span><span class="com">//stopAndReleaseEncoders();</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">      </span><span class="com">// out of while</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 </span></pre>
			</div>

		</div>



						<!-- 1. example number -->
		<div style="margin:20px 2px; color:#424345; font-weight:bold;">Example 13</div>

		<div class="examplebox">

			<!-- 2. description -->
			<div class="exampleboxheader">
				<table width="100%">

					<tbody><tr>

						<td width="85%" style="padding: 2px; font-size:14px;line-height: 25px;">
							Project: <span style="font-style:italic;">LiveMultimedia-master</span>
							<!--File:  <span style="font-style:italic;">/app/src/main/java/com/constantinnovationsinc/livemultimedia/encoders/GPUEncoder.java</span>-->
							<a href="http://www.programcreek.com/java-api-examples/index.php?source_dir=LiveMultimedia-master/app/src/main/java/com/constantinnovationsinc/livemultimedia/encoders/GPUEncoder.java">
								<span style="font-style:italic;">View Source</span>
							</a>
						</td>

						<td width="8%" align="right" style="padding-right:5px; font-size:14px;">

								<span class="vote click_button" id="2276442==android.media.MediaCodec" data-hasqtip="14">
									<!--<img alt="vote" src="./includes/images/like.png" width="25"/>-->
									Vote up
								</span>
						</td>

						<td width="10%" align="right" style="padding-right:5px; font-size:12px;">
							<span id="2276442votes">5</span>
							votes
						</td>
					</tr>
				</tbody></table>




			</div>


			<!-- 3. code -->
			<div class="exampleboxbody">
				<pre class="prettyprint"><span class="com">/******************************************************************
 * Encode from buffer rather than a surface
 * @param frameNum = the frame to be encoded
 ******************************************************************/</span><span class="pln">
</span><span class="lit">@SuppressWarnings</span><span class="pun">(</span><span class="str">"all"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">synchronized</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> encodeVideoFromBuffer</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> frameNum</span><span class="pun">,</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pln"> codec</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> colorFormat </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mLastTrackProcessed</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">w</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Encoding video into H264!"</span><span class="pun">);</span><span class="pln">
    </span><span class="typ">MediaCodec</span><span class="pln"> encoder </span><span class="pun">=</span><span class="pln">      codec</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln">  encoderColorFormat </span><span class="pun">=</span><span class="pln"> colorFormat</span><span class="pun">;</span><span class="pln">

    </span><span class="com">// Loop until the output side is done.</span><span class="pln">
    </span><span class="kwd">boolean</span><span class="pln"> inputDone </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">boolean</span><span class="pln"> encoderDone </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">boolean</span><span class="pln"> outputDone </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> TIMEOUT_USEC </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10000</span><span class="pun">;</span><span class="pln">
    mVideoFrameEncoded</span><span class="pun">++;</span><span class="pln">
    </span><span class="com">// mVideoTime = mVideoFrameEncoded * 32; // 30 frame a second</span><span class="pln">

    </span><span class="typ">ByteBuffer</span><span class="pun">[]</span><span class="pln"> encoderInputBuffers </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">.</span><span class="pln">getInputBuffers</span><span class="pun">();</span><span class="pln">
    </span><span class="typ">ByteBuffer</span><span class="pun">[]</span><span class="pln"> encoderOutputBuffers </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">.</span><span class="pln">getOutputBuffers</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> checkIndex </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> badFrames </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="com">// The size of a frame of video data, in the formats we handle, is stride*sliceHeight</span><span class="pln">
    </span><span class="com">// for Y, and (stride/2)*(sliceHeight/2) for each of the Cb and Cr channels.  Application</span><span class="pln">
    </span><span class="com">// of algebra and assuming that stride==width and sliceHeight==height yields:</span><span class="pln">
    </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> frameData </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> videoFrame</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        frameData </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[</span><span class="pln">mEncodingWidth </span><span class="pun">*</span><span class="pln"> mEncodingHeight </span><span class="pun">*</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">];</span><span class="pln">
        videoFrame </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[</span><span class="pln">frameData</span><span class="pun">.</span><span class="pln">length</span><span class="pun">];</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">mSharedMemFile</span><span class="pun">.</span><span class="pln">isEmpty</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            mSharedMemFile</span><span class="pun">.</span><span class="pln">getNextFrame</span><span class="pun">(</span><span class="pln">frameNum</span><span class="pun">,</span><span class="pln"> videoFrame</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
       </span><span class="com">// color correct it</span><span class="pln">
       </span><span class="typ">System</span><span class="pun">.</span><span class="pln">arraycopy</span><span class="pun">(</span><span class="pln">videoFrame</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> frameData</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> videoFrame</span><span class="pun">.</span><span class="pln">length</span><span class="pun">);</span><span class="pln">

    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">OutOfMemoryError</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">e</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">());</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">finally</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

        </span><span class="com">// release it</span><span class="pln">
        videoFrame </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">inputDone</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> inputBufIndex </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">.</span><span class="pln">dequeueInputBuffer</span><span class="pun">(</span><span class="pln">TIMEOUT_USEC</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">inputBufIndex </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mSharedMemFile</span><span class="pun">.</span><span class="pln">isLastFrame</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="com">// Send an empty frame with the end-of-stream flag set.  If we set EOS</span><span class="pln">
                </span><span class="com">// on a frame with data, that frame data will be ignored, and the</span><span class="pln">
                </span><span class="com">// output will be short one frame.</span><span class="pln">
                mVideoTime </span><span class="pun">=</span><span class="pln"> computePresentationTime</span><span class="pun">(</span><span class="pln">frameNum</span><span class="pun">);</span><span class="pln">
                encoder</span><span class="pun">.</span><span class="pln">queueInputBuffer</span><span class="pun">(</span><span class="pln">inputBufIndex</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> mVideoTime</span><span class="pun">,</span><span class="pln">
                        </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">BUFFER_FLAG_END_OF_STREAM</span><span class="pun">);</span><span class="pln">
                inputDone </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">w</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"sent input EOS (with zero-length frame)"</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="typ">ByteBuffer</span><span class="pln"> inputBuf </span><span class="pun">=</span><span class="pln"> encoderInputBuffers</span><span class="pun">[</span><span class="pln">inputBufIndex</span><span class="pun">];</span><span class="pln">
                </span><span class="com">// the buffer should be sized to hold one full frame</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">frameData </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> inputBuf</span><span class="pun">.</span><span class="pln">capacity</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> frameData</span><span class="pun">.</span><span class="pln">length</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">w</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"buffer resize to hold correct size"</span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pun">{</span><span class="pln">
                    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">e</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"buffer not correct size to fit a frame"</span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                inputBuf</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
                inputBuf</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">frameData</span><span class="pun">);</span><span class="pln">
                mVideoTime </span><span class="pun">=</span><span class="pln"> computePresentationTime</span><span class="pun">(</span><span class="pln">frameNum</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">frameData </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    encoder</span><span class="pun">.</span><span class="pln">queueInputBuffer</span><span class="pun">(</span><span class="pln">inputBufIndex</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> frameData</span><span class="pun">.</span><span class="pln">length</span><span class="pun">,</span><span class="pln"> mVideoTime</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">w</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"submitted frame : time  "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> mVideoFrameEncoded </span><span class="pun">+</span><span class="pln">  </span><span class="str">" : "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> mVideoTime </span><span class="pun">+</span><span class="pln"> </span><span class="str">" -&gt; to hardware encoder"</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="com">// either all in use, or we timed out during initial setup</span><span class="pln">
            </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"input buffer not available"</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">long</span><span class="pln"> rawSize </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">long</span><span class="pln"> encodedSize </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">encoderDone</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> encoderStatus </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">.</span><span class="highlight"><span class="pln">dequeueOutputBuffer</span></span><span class="pun">(</span><span class="pln">mBufferInfo </span><span class="pun">,</span><span class="pln"> TIMEOUT_USEC</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">switch</span><span class="pun">(</span><span class="pln">encoderStatus</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">case</span><span class="pln">  </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_TRY_AGAIN_LATER</span><span class="pun">:</span><span class="pln">
                </span><span class="com">// no output available yet</span><span class="pln">
                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"-------------------------------------------------------------"</span><span class="pun">);</span><span class="pln">
                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Encoder status: no output from encoder available"</span><span class="pun">);</span><span class="pln">
                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"-------------------------------------------------------------"</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">case</span><span class="pln">  </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_BUFFERS_CHANGED</span><span class="pun">:</span><span class="pln">
                </span><span class="com">// not expected for an encoder</span><span class="pln">
                encoderOutputBuffers </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">.</span><span class="pln">getOutputBuffers</span><span class="pun">();</span><span class="pln">
                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"-------------------------------------------------------------"</span><span class="pun">);</span><span class="pln">
                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Encoder status: encoder output buffers changed"</span><span class="pun">);</span><span class="pln">
                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"-------------------------------------------------------------"</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_FORMAT_CHANGED</span><span class="pun">:</span><span class="pln">
                </span><span class="com">// not expected for an encoder</span><span class="pln">
                mNewFormat </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">.</span><span class="pln">getOutputFormat</span><span class="pun">();</span><span class="pln">
                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"-------------------------------------------------------------"</span><span class="pun">);</span><span class="pln">
                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Encoder status: encoder output format changed: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> mNewFormat</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">());</span><span class="pln">
                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"-------------------------------------------------------------"</span><span class="pun">);</span><span class="pln">
                startMuxer</span><span class="pun">();</span><span class="pln">
                </span><span class="com">// reduce the encoded video tracks</span><span class="pln">
                mVideoFrameEncoded </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
               </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">default</span><span class="pun">:</span><span class="pln">
                </span><span class="typ">ByteBuffer</span><span class="pln"> encodedData </span><span class="pun">=</span><span class="pln"> encoderOutputBuffers</span><span class="pun">[</span><span class="pln">encoderStatus</span><span class="pun">];</span><span class="pln">
                </span><span class="com">// Codec config info.  Only expected on first packet.  One way to</span><span class="pln">
                </span><span class="com">// handle this is to manually stuff the data into the MediaFormat</span><span class="pln">
                </span><span class="com">// and pass that to configure().</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">mBufferInfo</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">&amp;</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">BUFFER_FLAG_CODEC_CONFIG</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="com">// The codec config data was pulled out and fed to the muxer when we got</span><span class="pln">
                    </span><span class="com">// the INFO_OUTPUT_FORMAT_CHANGED status.  Ignore it.</span><span class="pln">
                    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"ignoring BUFFER_FLAG_CODEC_CONFIG"</span><span class="pun">);</span><span class="pln">
                    mBufferInfo</span><span class="pun">.</span><span class="pln">size </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">encodedData </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">e</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"encoderOutputBuffer "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> encoderStatus </span><span class="pun">+</span><span class="pln"> </span><span class="str">" was null"</span><span class="pun">);</span><span class="pln">
                    </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln">  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> mVideoFrameEncoded  </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"-----------------------------------"</span><span class="pun">);</span><span class="pln">
                    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Setting csd-0 on first track"</span><span class="pun">);</span><span class="pln">
                    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"-----------------------------------"</span><span class="pun">);</span><span class="pln">
                    mFormat</span><span class="pun">.</span><span class="pln">setByteBuffer</span><span class="pun">(</span><span class="str">"csd-0"</span><span class="pun">,</span><span class="pln"> encodedData</span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                    </span><span class="com">// It's usually necessary to adjust the ByteBuffer values to match BufferInfo.</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mBufferInfo</span><span class="pun">.</span><span class="pln">size </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">encodedData </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> mBufferInfo </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        encodedData</span><span class="pun">.</span><span class="pln">position</span><span class="pun">(</span><span class="pln">mBufferInfo</span><span class="pun">.</span><span class="pln">offset</span><span class="pun">);</span><span class="pln">
                        encodedData</span><span class="pun">.</span><span class="pln">limit</span><span class="pun">(</span><span class="pln">mBufferInfo</span><span class="pun">.</span><span class="pln">offset </span><span class="pun">+</span><span class="pln"> mBufferInfo</span><span class="pun">.</span><span class="pln">size</span><span class="pun">);</span><span class="pln">
                        encodedSize </span><span class="pun">+=</span><span class="pln"> mBufferInfo</span><span class="pun">.</span><span class="pln">size</span><span class="pun">;</span><span class="pln">
                        </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">w</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"----&gt;Writing Video data using MediaMuxer"</span><span class="pun">);</span><span class="pln">
                        mMuxer</span><span class="pun">.</span><span class="pln">writeSampleData</span><span class="pun">(</span><span class="pln">mVideoTrackIndex</span><span class="pun">,</span><span class="pln"> encodedData</span><span class="pun">,</span><span class="pln"> mBufferInfo</span><span class="pun">);</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">  mAudioFeatureActive </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        encodeAudio</span><span class="pun">();</span><span class="pln">
                        </span><span class="com">// the first frames are configured and are skipped check for that</span><span class="pln">
                        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mCurrentEncodedAudioData </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                            </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">w</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"----&gt;Writing Audio data using MediaMuxer"</span><span class="pun">);</span><span class="pln">
                            </span><span class="typ">ByteBuffer</span><span class="pln"> audioData </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ByteBuffer</span><span class="pun">.</span><span class="pln">wrap</span><span class="pun">(</span><span class="pln">mCurrentEncodedAudioData</span><span class="pun">);</span><span class="pln">
                            mMuxer</span><span class="pun">.</span><span class="pln">writeSampleData</span><span class="pun">(</span><span class="pln">mAudioTrackIndex</span><span class="pun">,</span><span class="pln"> audioData</span><span class="pun">,</span><span class="pln"> mBufferInfo</span><span class="pun">);</span><span class="pln">
                        </span><span class="pun">}</span><span class="pln">
                        mCurrentEncodedAudioData </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="com">// now release the encoder buffer so the MediaCodec can reuse</span><span class="pln">
                 encoder</span><span class="pun">.</span><span class="pln">releaseOutputBuffer</span><span class="pun">(</span><span class="pln">encoderStatus</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">mBufferInfo</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">&amp;</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">BUFFER_FLAG_END_OF_STREAM</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"output EOS"</span><span class="pun">);</span><span class="pln">
                    mLastTrackProcessed </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="com">// END OF ENODER STATUS &gt; 0</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">     </span><span class="com">// EMD OF ENCODER LOOP</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 </span></pre>
			</div>

		</div>



						<!-- 1. example number -->
		<div style="margin:20px 2px; color:#424345; font-weight:bold;">Example 14</div>

		<div class="examplebox">

			<!-- 2. description -->
			<div class="exampleboxheader">
				<table width="100%">

					<tbody><tr>

						<td width="85%" style="padding: 2px; font-size:14px;line-height: 25px;">
							Project: <span style="font-style:italic;">effective_android_sample-master</span>
							<!--File:  <span style="font-style:italic;">/chapter33/JellyBeanMediaApiSampleProject/JellyBeanMediaApiSample/src/main/java/jp/muo/jellybeanmediaapisample/MainActivity.java</span>-->
							<a href="http://www.programcreek.com/java-api-examples/index.php?source_dir=effective_android_sample-master/chapter33/JellyBeanMediaApiSampleProject/JellyBeanMediaApiSample/src/main/java/jp/muo/jellybeanmediaapisample/MainActivity.java">
								<span style="font-style:italic;">View Source</span>
							</a>
						</td>

						<td width="8%" align="right" style="padding-right:5px; font-size:14px;">

								<span class="vote click_button" id="2912198==android.media.MediaCodec" data-hasqtip="15">
									<!--<img alt="vote" src="./includes/images/like.png" width="25"/>-->
									Vote up
								</span>
						</td>

						<td width="10%" align="right" style="padding-right:5px; font-size:12px;">
							<span id="2912198votes">5</span>
							votes
						</td>
					</tr>
				</tbody></table>




			</div>


			<!-- 3. code -->
			<div class="exampleboxbody">
				<pre class="prettyprint"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> playVorbisPlainWithMediaCodec</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">AssetFileDescriptor</span><span class="pln"> descriptor </span><span class="pun">=</span><span class="pln"> getResources</span><span class="pun">().</span><span class="pln">openRawResourceFd</span><span class="pun">(</span><span class="pln">R</span><span class="pun">.</span><span class="pln">raw</span><span class="pun">.</span><span class="pln">sin_3sec_plain</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">MediaExtractor</span><span class="pln"> extractor </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MediaExtractor</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        extractor</span><span class="pun">.</span><span class="pln">setDataSource</span><span class="pun">(</span><span class="pln">descriptor</span><span class="pun">.</span><span class="pln">getFileDescriptor</span><span class="pun">(),</span><span class="pln"> descriptor</span><span class="pun">.</span><span class="pln">getStartOffset</span><span class="pun">(),</span><span class="pln"> descriptor</span><span class="pun">.</span><span class="pln">getLength</span><span class="pun">());</span><span class="pln">
        </span><span class="typ">MediaFormat</span><span class="pln"> format </span><span class="pun">=</span><span class="pln"> extractor</span><span class="pun">.</span><span class="pln">getTrackFormat</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> sampleRate </span><span class="pun">=</span><span class="pln"> format</span><span class="pun">.</span><span class="pln">getInteger</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_SAMPLE_RATE</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> channels </span><span class="pun">=</span><span class="pln"> format</span><span class="pun">.</span><span class="pln">getInteger</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_CHANNEL_COUNT</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> mimeType </span><span class="pun">=</span><span class="pln"> format</span><span class="pun">.</span><span class="pln">getString</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_MIME</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> duration </span><span class="pun">=</span><span class="pln"> format</span><span class="pun">.</span><span class="pln">getLong</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_DURATION</span><span class="pun">);</span><span class="pln">
        </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="str">"[MediaFormat] MIME: %s, sampling-rate: %d, channels: %d, duration: %d us"</span><span class="pun">,</span><span class="pln">
                mimeType</span><span class="pun">,</span><span class="pln">
                sampleRate</span><span class="pun">,</span><span class="pln">
                channels</span><span class="pun">,</span><span class="pln">
                duration</span><span class="pun">));</span><span class="pln">

        </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pln"> codec </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">createDecoderByType</span><span class="pun">(</span><span class="pln">format</span><span class="pun">.</span><span class="pln">getString</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_MIME</span><span class="pun">));</span><span class="pln">
        codec</span><span class="pun">.</span><span class="pln">configure</span><span class="pun">(</span><span class="pln">format</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
        codec</span><span class="pun">.</span><span class="pln">start</span><span class="pun">();</span><span class="pln">

        </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">ByteBuffer</span><span class="pun">[]</span><span class="pln"> inputBuffers </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">getInputBuffers</span><span class="pun">();</span><span class="pln">
        </span><span class="typ">ByteBuffer</span><span class="pun">[]</span><span class="pln"> outputBuffers </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">getOutputBuffers</span><span class="pun">();</span><span class="pln">
        extractor</span><span class="pun">.</span><span class="pln">selectTrack</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">boolean</span><span class="pln"> inBufFinished </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">boolean</span><span class="pln"> outBufFinished </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">AudioTrack</span><span class="pln"> audioTrack </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AudioTrack</span><span class="pun">(</span><span class="pln">
                </span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">STREAM_MUSIC</span><span class="pun">,</span><span class="pln">
                sampleRate</span><span class="pun">,</span><span class="pln">
                </span><span class="pun">(</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> channels </span><span class="pun">?</span><span class="pln"> </span><span class="typ">AudioFormat</span><span class="pun">.</span><span class="pln">CHANNEL_OUT_STEREO </span><span class="pun">:</span><span class="pln"> </span><span class="typ">AudioFormat</span><span class="pun">.</span><span class="pln">CHANNEL_OUT_MONO</span><span class="pun">),</span><span class="pln">
                </span><span class="typ">AudioFormat</span><span class="pun">.</span><span class="pln">ENCODING_PCM_16BIT</span><span class="pun">,</span><span class="pln">
                sampleRate </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln">
                </span><span class="typ">AudioTrack</span><span class="pun">.</span><span class="pln">MODE_STREAM
                </span><span class="pun">);</span><span class="pln">
        audioTrack</span><span class="pun">.</span><span class="pln">play</span><span class="pun">();</span><span class="pln">
        </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="typ">BufferInfo</span><span class="pln"> bufferInfo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="typ">BufferInfo</span><span class="pun">();</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(;</span><span class="pln"> </span><span class="pun">;</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">inBufFinished</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> inputBufferIdx </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">dequeueInputBuffer</span><span class="pun">(</span><span class="pln">QUEUE_TIMEOUT_US</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> inputBufferIdx</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="typ">ByteBuffer</span><span class="pln"> currentInputBuffer </span><span class="pun">=</span><span class="pln"> inputBuffers</span><span class="pun">[</span><span class="pln">inputBufferIdx</span><span class="pun">];</span><span class="pln">
                    </span><span class="kwd">int</span><span class="pln"> sampleSize </span><span class="pun">=</span><span class="pln"> extractor</span><span class="pun">.</span><span class="pln">readSampleData</span><span class="pun">(</span><span class="pln">currentInputBuffer</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sampleSize </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        </span><span class="kwd">long</span><span class="pln"> presentationTimeUs </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
                        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> sampleSize</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                            presentationTimeUs </span><span class="pun">=</span><span class="pln"> extractor</span><span class="pun">.</span><span class="pln">getSampleTime</span><span class="pun">();</span><span class="pln">
                        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                            inBufFinished </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
                        </span><span class="pun">}</span><span class="pln">
                        </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> decBuffer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[</span><span class="pln">sampleSize</span><span class="pun">];</span><span class="pln">
                        currentInputBuffer</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">decBuffer</span><span class="pun">);</span><span class="pln">
                        currentInputBuffer</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
                        </span><span class="com">// ???????????(???)</span><span class="pln">
                        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> decBuffer</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                            decBuffer</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> decBuffer</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
                        </span><span class="pun">}</span><span class="pln">
                        currentInputBuffer</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">decBuffer</span><span class="pun">);</span><span class="pln">
                        </span><span class="com">// ???????queue??????????????currentInputBuffer?position?</span><span class="pln">
                        </span><span class="com">// 0??????????????????????????position???????</span><span class="pln">
                        </span><span class="com">// queueInputBuffer??2???????????????????</span><span class="pln">
                        currentInputBuffer</span><span class="pun">.</span><span class="pln">position</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln">

                        codec</span><span class="pun">.</span><span class="pln">queueInputBuffer</span><span class="pun">(</span><span class="pln">inputBufferIdx</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> sampleSize</span><span class="pun">,</span><span class="pln"> presentationTimeUs</span><span class="pun">,</span><span class="pln"> inBufFinished </span><span class="pun">?</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">BUFFER_FLAG_END_OF_STREAM </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
                        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">inBufFinished</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                            extractor</span><span class="pun">.</span><span class="pln">advance</span><span class="pun">();</span><span class="pln">
                        </span><span class="pun">}</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    inBufFinished </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">

            </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> outputBufferIdx </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="highlight"><span class="pln">dequeueOutputBuffer</span></span><span class="pun">(</span><span class="pln">bufferInfo</span><span class="pun">,</span><span class="pln"> QUEUE_TIMEOUT_US</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> outputBufferIdx</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> outBuf </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[</span><span class="pln">bufferInfo</span><span class="pun">.</span><span class="pln">size</span><span class="pun">];</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">bufferInfo</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">&amp;</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">BUFFER_FLAG_END_OF_STREAM</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    outBufFinished </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">ByteBuffer</span><span class="pln"> intermediateBuffer </span><span class="pun">=</span><span class="pln"> outputBuffers</span><span class="pun">[</span><span class="pln">outputBufferIdx</span><span class="pun">];</span><span class="pln">
                intermediateBuffer</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">outBuf</span><span class="pun">);</span><span class="pln">
                intermediateBuffer</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
                </span><span class="com">// ????????????(???)</span><span class="pln">
                </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> outBuf</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    outBuf</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> outBuf</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                audioTrack</span><span class="pun">.</span><span class="pln">write</span><span class="pun">(</span><span class="pln">outBuf</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> outBuf</span><span class="pun">.</span><span class="pln">length</span><span class="pun">);</span><span class="pln">
                codec</span><span class="pun">.</span><span class="pln">releaseOutputBuffer</span><span class="pun">(</span><span class="pln">outputBufferIdx</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">outputBufferIdx </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_BUFFERS_CHANGED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                outputBuffers </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">getOutputBuffers</span><span class="pun">();</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">outputBufferIdx </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_FORMAT_CHANGED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                format </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">getOutputFormat</span><span class="pun">();</span><span class="pln">
                audioTrack</span><span class="pun">.</span><span class="pln">setPlaybackRate</span><span class="pun">(</span><span class="pln">format</span><span class="pun">.</span><span class="pln">getInteger</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_SAMPLE_RATE</span><span class="pun">));</span><span class="pln">
                </span><span class="com">// ???????????????????????????????audioTrack?????????</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">outputBufferIdx </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_TRY_AGAIN_LATER</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="com">// ??????????????????????????????????????????????????????????</span><span class="pln">
                </span><span class="com">// ?????????????????????????????????????</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">inBufFinished</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    outBufFinished </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">

            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">inBufFinished </span><span class="pun">&amp;&amp;</span><span class="pln"> outBufFinished</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        audioTrack</span><span class="pun">.</span><span class="pln">stop</span><span class="pun">();</span><span class="pln">
        audioTrack</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln">
        codec</span><span class="pun">.</span><span class="pln">stop</span><span class="pun">();</span><span class="pln">
        codec</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IOException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        e</span><span class="pun">.</span><span class="pln">printStackTrace</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 </span></pre>
			</div>

		</div>



						<!-- 1. example number -->
		<div style="margin:20px 2px; color:#424345; font-weight:bold;">Example 15</div>

		<div class="examplebox">

			<!-- 2. description -->
			<div class="exampleboxheader">
				<table width="100%">

					<tbody><tr>

						<td width="85%" style="padding: 2px; font-size:14px;line-height: 25px;">
							Project: <span style="font-style:italic;">ringdroid-master</span>
							<!--File:  <span style="font-style:italic;">/src/com/ringdroid/soundfile/SoundFile.java</span>-->
							<a href="http://www.programcreek.com/java-api-examples/index.php?source_dir=ringdroid-master/src/com/ringdroid/soundfile/SoundFile.java">
								<span style="font-style:italic;">View Source</span>
							</a>
						</td>

						<td width="8%" align="right" style="padding-right:5px; font-size:14px;">

								<span class="vote click_button" id="3529975==android.media.MediaCodec" data-hasqtip="16">
									<!--<img alt="vote" src="./includes/images/like.png" width="25"/>-->
									Vote up
								</span>
						</td>

						<td width="10%" align="right" style="padding-right:5px; font-size:12px;">
							<span id="3529975votes">5</span>
							votes
						</td>
					</tr>
				</tbody></table>




			</div>


			<!-- 3. code -->
			<div class="exampleboxbody">
				<pre class="prettyprint"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> </span><span class="typ">ReadFile</span><span class="pun">(</span><span class="typ">File</span><span class="pln"> inputFile</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">throws</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">FileNotFoundException</span><span class="pun">,</span><span class="pln">
           java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">IOException</span><span class="pun">,</span><span class="pln"> </span><span class="typ">InvalidInputException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">MediaExtractor</span><span class="pln"> extractor </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MediaExtractor</span><span class="pun">();</span><span class="pln">
    </span><span class="typ">MediaFormat</span><span class="pln"> format </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">

    mInputFile </span><span class="pun">=</span><span class="pln"> inputFile</span><span class="pun">;</span><span class="pln">
    </span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> components </span><span class="pun">=</span><span class="pln"> mInputFile</span><span class="pun">.</span><span class="pln">getPath</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">"\\."</span><span class="pun">);</span><span class="pln">
    mFileType </span><span class="pun">=</span><span class="pln"> components</span><span class="pun">[</span><span class="pln">components</span><span class="pun">.</span><span class="pln">length </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
    mFileSize </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln">mInputFile</span><span class="pun">.</span><span class="pln">length</span><span class="pun">();</span><span class="pln">
    extractor</span><span class="pun">.</span><span class="pln">setDataSource</span><span class="pun">(</span><span class="pln">mInputFile</span><span class="pun">.</span><span class="pln">getPath</span><span class="pun">());</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> numTracks </span><span class="pun">=</span><span class="pln"> extractor</span><span class="pun">.</span><span class="pln">getTrackCount</span><span class="pun">();</span><span class="pln">
    </span><span class="com">// find and select the first audio track present in the file.</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">&lt;</span><span class="pln">numTracks</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        format </span><span class="pun">=</span><span class="pln"> extractor</span><span class="pun">.</span><span class="pln">getTrackFormat</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">format</span><span class="pun">.</span><span class="pln">getString</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_MIME</span><span class="pun">).</span><span class="pln">startsWith</span><span class="pun">(</span><span class="str">"audio/"</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            extractor</span><span class="pun">.</span><span class="pln">selectTrack</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">==</span><span class="pln"> numTracks</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">InvalidInputException</span><span class="pun">(</span><span class="str">"No audio track found in "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> mInputFile</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    mChannels </span><span class="pun">=</span><span class="pln"> format</span><span class="pun">.</span><span class="pln">getInteger</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_CHANNEL_COUNT</span><span class="pun">);</span><span class="pln">
    mSampleRate </span><span class="pun">=</span><span class="pln"> format</span><span class="pun">.</span><span class="pln">getInteger</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_SAMPLE_RATE</span><span class="pun">);</span><span class="pln">
    </span><span class="com">// Expected total number of samples per channel.</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> expectedNumSamples </span><span class="pun">=</span><span class="pln">
        </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)((</span><span class="pln">format</span><span class="pun">.</span><span class="pln">getLong</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_DURATION</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">1000000.f</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> mSampleRate </span><span class="pun">+</span><span class="pln"> </span><span class="lit">0.5f</span><span class="pun">);</span><span class="pln">

    </span><span class="typ">MediaCodec</span><span class="pln"> codec </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">createDecoderByType</span><span class="pun">(</span><span class="pln">format</span><span class="pun">.</span><span class="pln">getString</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_MIME</span><span class="pun">));</span><span class="pln">
    codec</span><span class="pun">.</span><span class="pln">configure</span><span class="pun">(</span><span class="pln">format</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
    codec</span><span class="pun">.</span><span class="pln">start</span><span class="pun">();</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> decodedSamplesSize </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">  </span><span class="com">// size of the output buffer containing decoded samples.</span><span class="pln">
    </span><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> decodedSamples </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="typ">ByteBuffer</span><span class="pun">[]</span><span class="pln"> inputBuffers </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">getInputBuffers</span><span class="pun">();</span><span class="pln">
    </span><span class="typ">ByteBuffer</span><span class="pun">[]</span><span class="pln"> outputBuffers </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">getOutputBuffers</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> sample_size</span><span class="pun">;</span><span class="pln">
    </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="typ">BufferInfo</span><span class="pln"> info </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="typ">BufferInfo</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">long</span><span class="pln"> presentation_time</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> tot_size_read </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">boolean</span><span class="pln"> done_reading </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">

    </span><span class="com">// Set the size of the decoded samples buffer to 1MB (~6sec of a stereo stream at 44.1kHz).</span><span class="pln">
    </span><span class="com">// For longer streams, the buffer size will be increased later on, calculating a rough</span><span class="pln">
    </span><span class="com">// estimate of the total size needed to store all the samples in order to resize the buffer</span><span class="pln">
    </span><span class="com">// only once.</span><span class="pln">
    mDecodedBytes </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ByteBuffer</span><span class="pun">.</span><span class="pln">allocate</span><span class="pun">(</span><span class="lit">1</span><span class="pun">&lt;&lt;</span><span class="lit">20</span><span class="pun">);</span><span class="pln">
    </span><span class="typ">Boolean</span><span class="pln"> firstSampleData </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">// read data from file and feed it to the decoder input buffers.</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> inputBufferIndex </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">dequeueInputBuffer</span><span class="pun">(</span><span class="lit">100</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">done_reading </span><span class="pun">&amp;&amp;</span><span class="pln"> inputBufferIndex </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            sample_size </span><span class="pun">=</span><span class="pln"> extractor</span><span class="pun">.</span><span class="pln">readSampleData</span><span class="pun">(</span><span class="pln">inputBuffers</span><span class="pun">[</span><span class="pln">inputBufferIndex</span><span class="pun">],</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">firstSampleData
                    </span><span class="pun">&amp;&amp;</span><span class="pln"> format</span><span class="pun">.</span><span class="pln">getString</span><span class="pun">(</span><span class="typ">MediaFormat</span><span class="pun">.</span><span class="pln">KEY_MIME</span><span class="pun">).</span><span class="pln">equals</span><span class="pun">(</span><span class="str">"audio/mp4a-latm"</span><span class="pun">)</span><span class="pln">
                    </span><span class="pun">&amp;&amp;</span><span class="pln"> sample_size </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="com">// For some reasons on some devices (e.g. the Samsung S3) you should not</span><span class="pln">
                </span><span class="com">// provide the first two bytes of an AAC stream, otherwise the MediaCodec will</span><span class="pln">
                </span><span class="com">// crash. These two bytes do not contain music data but basic info on the</span><span class="pln">
                </span><span class="com">// stream (e.g. channel configuration and sampling frequency), and skipping them</span><span class="pln">
                </span><span class="com">// seems OK with other devices (MediaCodec has already been configured and</span><span class="pln">
                </span><span class="com">// already knows these parameters).</span><span class="pln">
                extractor</span><span class="pun">.</span><span class="pln">advance</span><span class="pun">();</span><span class="pln">
                tot_size_read </span><span class="pun">+=</span><span class="pln"> sample_size</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sample_size </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="com">// All samples have been read.</span><span class="pln">
                codec</span><span class="pun">.</span><span class="pln">queueInputBuffer</span><span class="pun">(</span><span class="pln">
                        inputBufferIndex</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">BUFFER_FLAG_END_OF_STREAM</span><span class="pun">);</span><span class="pln">
                done_reading </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                presentation_time </span><span class="pun">=</span><span class="pln"> extractor</span><span class="pun">.</span><span class="pln">getSampleTime</span><span class="pun">();</span><span class="pln">
                codec</span><span class="pun">.</span><span class="pln">queueInputBuffer</span><span class="pun">(</span><span class="pln">inputBufferIndex</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> sample_size</span><span class="pun">,</span><span class="pln"> presentation_time</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
                extractor</span><span class="pun">.</span><span class="pln">advance</span><span class="pun">();</span><span class="pln">
                tot_size_read </span><span class="pun">+=</span><span class="pln"> sample_size</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mProgressListener </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">mProgressListener</span><span class="pun">.</span><span class="pln">reportProgress</span><span class="pun">((</span><span class="kwd">float</span><span class="pun">)(</span><span class="pln">tot_size_read</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> mFileSize</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        </span><span class="com">// We are asked to stop reading the file. Returning immediately. The</span><span class="pln">
                        </span><span class="com">// SoundFile object is invalid and should NOT be used afterward!</span><span class="pln">
                        extractor</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln">
                        extractor </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
                        codec</span><span class="pun">.</span><span class="pln">stop</span><span class="pun">();</span><span class="pln">
                        codec</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln">
                        codec </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
                        </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            firstSampleData </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="com">// Get decoded stream from the decoder output buffers.</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> outputBufferIndex </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="highlight"><span class="pln">dequeueOutputBuffer</span></span><span class="pun">(</span><span class="pln">info</span><span class="pun">,</span><span class="pln"> </span><span class="lit">100</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">outputBufferIndex </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> info</span><span class="pun">.</span><span class="pln">size </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">decodedSamplesSize </span><span class="pun">&lt;</span><span class="pln"> info</span><span class="pun">.</span><span class="pln">size</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                decodedSamplesSize </span><span class="pun">=</span><span class="pln"> info</span><span class="pun">.</span><span class="pln">size</span><span class="pun">;</span><span class="pln">
                decodedSamples </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">[</span><span class="pln">decodedSamplesSize</span><span class="pun">];</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            outputBuffers</span><span class="pun">[</span><span class="pln">outputBufferIndex</span><span class="pun">].</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">decodedSamples</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> info</span><span class="pun">.</span><span class="pln">size</span><span class="pun">);</span><span class="pln">
            outputBuffers</span><span class="pun">[</span><span class="pln">outputBufferIndex</span><span class="pun">].</span><span class="pln">clear</span><span class="pun">();</span><span class="pln">
            </span><span class="com">// Check if buffer is big enough. Resize it if it's too small.</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mDecodedBytes</span><span class="pun">.</span><span class="pln">remaining</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> info</span><span class="pun">.</span><span class="pln">size</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="com">// Getting a rough estimate of the total size, allocate 20% more, and</span><span class="pln">
                </span><span class="com">// make sure to allocate at least 5MB more than the initial size.</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> position </span><span class="pun">=</span><span class="pln"> mDecodedBytes</span><span class="pun">.</span><span class="pln">position</span><span class="pun">();</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> newSize </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)((</span><span class="pln">position </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1.0</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> mFileSize </span><span class="pun">/</span><span class="pln"> tot_size_read</span><span class="pun">))</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">1.2</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">newSize </span><span class="pun">-</span><span class="pln"> position </span><span class="pun">&lt;</span><span class="pln"> info</span><span class="pun">.</span><span class="pln">size </span><span class="pun">+</span><span class="pln"> </span><span class="lit">5</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pun">&lt;&lt;</span><span class="lit">20</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    newSize </span><span class="pun">=</span><span class="pln"> position </span><span class="pun">+</span><span class="pln"> info</span><span class="pun">.</span><span class="pln">size </span><span class="pun">+</span><span class="pln"> </span><span class="lit">5</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pun">&lt;&lt;</span><span class="lit">20</span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="typ">ByteBuffer</span><span class="pln"> newDecodedBytes </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
                </span><span class="com">// Try to allocate memory. If we are OOM, try to run the garbage collector.</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">retry</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">while</span><span class="pun">(</span><span class="kwd">retry</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        newDecodedBytes </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ByteBuffer</span><span class="pun">.</span><span class="pln">allocate</span><span class="pun">(</span><span class="pln">newSize</span><span class="pun">);</span><span class="pln">
                        </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">OutOfMemoryError</span><span class="pln"> oome</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        </span><span class="com">// setting android:largeHeap="true" in &lt;application&gt; seem to help not</span><span class="pln">
                        </span><span class="com">// reaching this section.</span><span class="pln">
                        </span><span class="kwd">retry</span><span class="pun">--;</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">retry</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="com">// Failed to allocate memory... Stop reading more data and finalize the</span><span class="pln">
                    </span><span class="com">// instance with the data decoded so far.</span><span class="pln">
                    </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="com">//ByteBuffer newDecodedBytes = ByteBuffer.allocate(newSize);</span><span class="pln">
                mDecodedBytes</span><span class="pun">.</span><span class="pln">rewind</span><span class="pun">();</span><span class="pln">
                newDecodedBytes</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">mDecodedBytes</span><span class="pun">);</span><span class="pln">
                mDecodedBytes </span><span class="pun">=</span><span class="pln"> newDecodedBytes</span><span class="pun">;</span><span class="pln">
                mDecodedBytes</span><span class="pun">.</span><span class="pln">position</span><span class="pun">(</span><span class="pln">position</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            mDecodedBytes</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">decodedSamples</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> info</span><span class="pun">.</span><span class="pln">size</span><span class="pun">);</span><span class="pln">
            codec</span><span class="pun">.</span><span class="pln">releaseOutputBuffer</span><span class="pun">(</span><span class="pln">outputBufferIndex</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">outputBufferIndex </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_BUFFERS_CHANGED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            outputBuffers </span><span class="pun">=</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">getOutputBuffers</span><span class="pun">();</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">outputBufferIndex </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_FORMAT_CHANGED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="com">// Subsequent data will conform to new format.</span><span class="pln">
            </span><span class="com">// We could check that codec.getOutputFormat(), which is the new output format,</span><span class="pln">
            </span><span class="com">// is what we expect.</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">info</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">&amp;</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">BUFFER_FLAG_END_OF_STREAM</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
                </span><span class="pun">||</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mDecodedBytes</span><span class="pun">.</span><span class="pln">position</span><span class="pun">()</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="pun">(</span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> mChannels</span><span class="pun">))</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> expectedNumSamples</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="com">// We got all the decoded data from the decoder. Stop here.</span><span class="pln">
            </span><span class="com">// Theoretically </span><span class="highlight"><span class="com">dequeueOutputBuffer</span></span><span class="com">(info, ...) should have set info.flags to</span><span class="pln">
            </span><span class="com">// MediaCodec.BUFFER_FLAG_END_OF_STREAM. However some phones (e.g. Samsung S3)</span><span class="pln">
            </span><span class="com">// won't do that for some files (e.g. with mono AAC files), in which case subsequent</span><span class="pln">
            </span><span class="com">// calls to </span><span class="highlight"><span class="com">dequeueOutputBuffer</span></span><span class="com"> may result in the application crashing, without</span><span class="pln">
            </span><span class="com">// even an exception being thrown... Hence the second check.</span><span class="pln">
            </span><span class="com">// (for mono AAC files, the S3 will actually double each sample, as if the stream</span><span class="pln">
            </span><span class="com">// was stereo. The resulting stream is half what it's supposed to be and with a much</span><span class="pln">
            </span><span class="com">// lower pitch.)</span><span class="pln">
            </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    mNumSamples </span><span class="pun">=</span><span class="pln"> mDecodedBytes</span><span class="pun">.</span><span class="pln">position</span><span class="pun">()</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mChannels </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span><span class="pln">  </span><span class="com">// One sample = 2 bytes.</span><span class="pln">
    mDecodedBytes</span><span class="pun">.</span><span class="pln">rewind</span><span class="pun">();</span><span class="pln">
    mDecodedBytes</span><span class="pun">.</span><span class="pln">order</span><span class="pun">(</span><span class="typ">ByteOrder</span><span class="pun">.</span><span class="pln">LITTLE_ENDIAN</span><span class="pun">);</span><span class="pln">
    mDecodedSamples </span><span class="pun">=</span><span class="pln"> mDecodedBytes</span><span class="pun">.</span><span class="pln">asShortBuffer</span><span class="pun">();</span><span class="pln">
    mAvgBitRate </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)((</span><span class="pln">mFileSize </span><span class="pun">*</span><span class="pln"> </span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">((</span><span class="kwd">float</span><span class="pun">)</span><span class="pln">mSampleRate </span><span class="pun">/</span><span class="pln"> mNumSamples</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">1000</span><span class="pun">);</span><span class="pln">

    extractor</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln">
    extractor </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    codec</span><span class="pun">.</span><span class="pln">stop</span><span class="pun">();</span><span class="pln">
    codec</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln">
    codec </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">

    </span><span class="com">// Temporary hack to make it work with the old version.</span><span class="pln">
    mNumFrames </span><span class="pun">=</span><span class="pln"> mNumSamples </span><span class="pun">/</span><span class="pln"> getSamplesPerFrame</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mNumSamples </span><span class="pun">%</span><span class="pln"> getSamplesPerFrame</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">){</span><span class="pln">
        mNumFrames</span><span class="pun">++;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    mFrameGains </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[</span><span class="pln">mNumFrames</span><span class="pun">];</span><span class="pln">
    mFrameLens </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[</span><span class="pln">mNumFrames</span><span class="pun">];</span><span class="pln">
    mFrameOffsets </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[</span><span class="pln">mNumFrames</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> j</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> gain</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> frameLens </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)((</span><span class="lit">1000</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> mAvgBitRate </span><span class="pun">/</span><span class="pln"> </span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln">
            </span><span class="pun">((</span><span class="kwd">float</span><span class="pun">)</span><span class="pln">getSamplesPerFrame</span><span class="pun">()</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> mSampleRate</span><span class="pun">));</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">&lt;</span><span class="pln">mNumFrames</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="pln">
        gain </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="pln">j</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">&lt;</span><span class="pln">getSamplesPerFrame</span><span class="pun">();</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            value </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> k</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln"> k</span><span class="pun">&lt;</span><span class="pln">mChannels</span><span class="pun">;</span><span class="pln"> k</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mDecodedSamples</span><span class="pun">.</span><span class="pln">remaining</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    value </span><span class="pun">+=</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">Math</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">mDecodedSamples</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">());</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            value </span><span class="pun">/=</span><span class="pln"> mChannels</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">gain </span><span class="pun">&lt;</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                gain </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        mFrameGains</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="typ">Math</span><span class="pun">.</span><span class="pln">sqrt</span><span class="pun">(</span><span class="pln">gain</span><span class="pun">);</span><span class="pln">  </span><span class="com">// here gain = sqrt(max value of 1st channel)...</span><span class="pln">
        mFrameLens</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> frameLens</span><span class="pun">;</span><span class="pln">  </span><span class="com">// totally not accurate...</span><span class="pln">
        mFrameOffsets</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)(</span><span class="pln">i </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1000</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> mAvgBitRate </span><span class="pun">/</span><span class="pln"> </span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln">  </span><span class="com">//  = i * frameLens</span><span class="pln">
                </span><span class="pun">((</span><span class="kwd">float</span><span class="pun">)</span><span class="pln">getSamplesPerFrame</span><span class="pun">()</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> mSampleRate</span><span class="pun">));</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    mDecodedSamples</span><span class="pun">.</span><span class="pln">rewind</span><span class="pun">();</span><span class="pln">
    </span><span class="com">// DumpSamples();  // Uncomment this line to dump the samples in a TSV file.</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 </span></pre>
			</div>

		</div>



						<!-- 1. example number -->
		<div style="margin:20px 2px; color:#424345; font-weight:bold;">Example 16</div>

		<div class="examplebox">

			<!-- 2. description -->
			<div class="exampleboxheader">
				<table width="100%">

					<tbody><tr>

						<td width="85%" style="padding: 2px; font-size:14px;line-height: 25px;">
							Project: <span style="font-style:italic;">grafika-master</span>
							<!--File:  <span style="font-style:italic;">/src/com/android/grafika/MoviePlayer.java</span>-->
							<a href="http://www.programcreek.com/java-api-examples/index.php?source_dir=grafika-master/src/com/android/grafika/MoviePlayer.java">
								<span style="font-style:italic;">View Source</span>
							</a>
						</td>

						<td width="8%" align="right" style="padding-right:5px; font-size:14px;">

								<span class="vote click_button" id="3680437==android.media.MediaCodec" data-hasqtip="17">
									<!--<img alt="vote" src="./includes/images/like.png" width="25"/>-->
									Vote up
								</span>
						</td>

						<td width="10%" align="right" style="padding-right:5px; font-size:12px;">
							<span id="3680437votes">5</span>
							votes
						</td>
					</tr>
				</tbody></table>




			</div>


			<!-- 3. code -->
			<div class="exampleboxbody">
				<pre class="prettyprint"><span class="com">/**
 * Work loop.  We execute here until we run out of video or are told to stop.
 */</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> doExtract</span><span class="pun">(</span><span class="typ">MediaExtractor</span><span class="pln"> extractor</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> trackIndex</span><span class="pun">,</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pln"> decoder</span><span class="pun">,</span><span class="pln">
        </span><span class="typ">FrameCallback</span><span class="pln"> frameCallback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// We need to strike a balance between providing input and reading output that</span><span class="pln">
    </span><span class="com">// operates efficiently without delays on the output side.</span><span class="pln">
    </span><span class="com">//</span><span class="pln">
    </span><span class="com">// To avoid delays on the output side, we need to keep the codec's input buffers</span><span class="pln">
    </span><span class="com">// fed.  There can be significant latency between submitting frame N to the decoder</span><span class="pln">
    </span><span class="com">// and receiving frame N on the output, so we need to stay ahead of the game.</span><span class="pln">
    </span><span class="com">//</span><span class="pln">
    </span><span class="com">// Many video decoders seem to want several frames of video before they start</span><span class="pln">
    </span><span class="com">// producing output -- one implementation wanted four before it appeared to</span><span class="pln">
    </span><span class="com">// configure itself.  We need to provide a bunch of input frames up front, and try</span><span class="pln">
    </span><span class="com">// to keep the queue full as we go.</span><span class="pln">
    </span><span class="com">//</span><span class="pln">
    </span><span class="com">// (Note it's possible for the encoded data to be written to the stream out of order,</span><span class="pln">
    </span><span class="com">// so we can't generally submit a single frame and wait for it to appear.)</span><span class="pln">
    </span><span class="com">//</span><span class="pln">
    </span><span class="com">// We can't just fixate on the input side though.  If we spend too much time trying</span><span class="pln">
    </span><span class="com">// to stuff the input, we might miss a presentation deadline.  At 60Hz we have 16.7ms</span><span class="pln">
    </span><span class="com">// between frames, so sleeping for 10ms would eat up a significant fraction of the</span><span class="pln">
    </span><span class="com">// time allowed.  (Most video is at 30Hz or less, so for most content we'll have</span><span class="pln">
    </span><span class="com">// significantly longer.)  Waiting for output is okay, but sleeping on availability</span><span class="pln">
    </span><span class="com">// of input buffers is unwise if we need to be providing output on a regular schedule.</span><span class="pln">
    </span><span class="com">//</span><span class="pln">
    </span><span class="com">//</span><span class="pln">
    </span><span class="com">// In some situations, startup latency may be a concern.  To minimize startup time,</span><span class="pln">
    </span><span class="com">// we'd want to stuff the input full as quickly as possible.  This turns out to be</span><span class="pln">
    </span><span class="com">// somewhat complicated, as the codec may still be starting up and will refuse to</span><span class="pln">
    </span><span class="com">// accept input.  Removing the timeout from dequeueInputBuffer() results in spinning</span><span class="pln">
    </span><span class="com">// on the CPU.</span><span class="pln">
    </span><span class="com">//</span><span class="pln">
    </span><span class="com">// If you have tight startup latency requirements, it would probably be best to</span><span class="pln">
    </span><span class="com">// "prime the pump" with a sequence of frames that aren't actually shown (e.g.</span><span class="pln">
    </span><span class="com">// grab the first 10 NAL units and shove them through, then rewind to the start of</span><span class="pln">
    </span><span class="com">// the first key frame).</span><span class="pln">
    </span><span class="com">//</span><span class="pln">
    </span><span class="com">// The actual latency seems to depend on strongly on the nature of the video (e.g.</span><span class="pln">
    </span><span class="com">// resolution).</span><span class="pln">
    </span><span class="com">//</span><span class="pln">
    </span><span class="com">//</span><span class="pln">
    </span><span class="com">// One conceptually nice approach is to loop on the input side to ensure that the codec</span><span class="pln">
    </span><span class="com">// always has all the input it can handle.  After submitting a buffer, we immediately</span><span class="pln">
    </span><span class="com">// check to see if it will accept another.  We can use a short timeout so we don't</span><span class="pln">
    </span><span class="com">// miss a presentation deadline.  On the output side we only check once, with a longer</span><span class="pln">
    </span><span class="com">// timeout, then return to the outer loop to see if the codec is hungry for more input.</span><span class="pln">
    </span><span class="com">//</span><span class="pln">
    </span><span class="com">// In practice, every call to check for available buffers involves a lot of message-</span><span class="pln">
    </span><span class="com">// passing between threads and processes.  Setting a very brief timeout doesn't</span><span class="pln">
    </span><span class="com">// exactly work because the overhead required to determine that no buffer is available</span><span class="pln">
    </span><span class="com">// is substantial.  On one device, the "clever" approach caused significantly greater</span><span class="pln">
    </span><span class="com">// and more highly variable startup latency.</span><span class="pln">
    </span><span class="com">//</span><span class="pln">
    </span><span class="com">// The code below takes a very simple-minded approach that works, but carries a risk</span><span class="pln">
    </span><span class="com">// of occasionally running out of output.  A more sophisticated approach might</span><span class="pln">
    </span><span class="com">// detect an output timeout and use that as a signal to try to enqueue several input</span><span class="pln">
    </span><span class="com">// buffers on the next iteration.</span><span class="pln">
    </span><span class="com">//</span><span class="pln">
    </span><span class="com">// If you want to experiment, set the VERBOSE flag to true and watch the behavior</span><span class="pln">
    </span><span class="com">// in logcat.  Use "logcat -v threadtime" to see sub-second timing.</span><span class="pln">

    </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> TIMEOUT_USEC </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10000</span><span class="pun">;</span><span class="pln">
    </span><span class="typ">ByteBuffer</span><span class="pun">[]</span><span class="pln"> decoderInputBuffers </span><span class="pun">=</span><span class="pln"> decoder</span><span class="pun">.</span><span class="pln">getInputBuffers</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> inputChunk </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">long</span><span class="pln"> firstInputTimeNsec </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">boolean</span><span class="pln"> outputDone </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">boolean</span><span class="pln"> inputDone </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">outputDone</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">VERBOSE</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"loop"</span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mIsStopRequested</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Stop requested"</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="com">// Feed more data to the decoder.</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">inputDone</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> inputBufIndex </span><span class="pun">=</span><span class="pln"> decoder</span><span class="pun">.</span><span class="pln">dequeueInputBuffer</span><span class="pun">(</span><span class="pln">TIMEOUT_USEC</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">inputBufIndex </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">firstInputTimeNsec </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    firstInputTimeNsec </span><span class="pun">=</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="pln">nanoTime</span><span class="pun">();</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="typ">ByteBuffer</span><span class="pln"> inputBuf </span><span class="pun">=</span><span class="pln"> decoderInputBuffers</span><span class="pun">[</span><span class="pln">inputBufIndex</span><span class="pun">];</span><span class="pln">
                </span><span class="com">// Read the sample data into the ByteBuffer.  This neither respects nor</span><span class="pln">
                </span><span class="com">// updates inputBuf's position, limit, etc.</span><span class="pln">
                </span><span class="kwd">int</span><span class="pln"> chunkSize </span><span class="pun">=</span><span class="pln"> extractor</span><span class="pun">.</span><span class="pln">readSampleData</span><span class="pun">(</span><span class="pln">inputBuf</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">chunkSize </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="com">// End of stream -- send empty frame with EOS flag set.</span><span class="pln">
                    decoder</span><span class="pun">.</span><span class="pln">queueInputBuffer</span><span class="pun">(</span><span class="pln">inputBufIndex</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0L</span><span class="pun">,</span><span class="pln">
                            </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">BUFFER_FLAG_END_OF_STREAM</span><span class="pun">);</span><span class="pln">
                    inputDone </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">VERBOSE</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"sent input EOS"</span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">extractor</span><span class="pun">.</span><span class="pln">getSampleTrackIndex</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> trackIndex</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">w</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"WEIRD: got sample from track "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                                extractor</span><span class="pun">.</span><span class="pln">getSampleTrackIndex</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">", expected "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> trackIndex</span><span class="pun">);</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                    </span><span class="kwd">long</span><span class="pln"> presentationTimeUs </span><span class="pun">=</span><span class="pln"> extractor</span><span class="pun">.</span><span class="pln">getSampleTime</span><span class="pun">();</span><span class="pln">
                    decoder</span><span class="pun">.</span><span class="pln">queueInputBuffer</span><span class="pun">(</span><span class="pln">inputBufIndex</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> chunkSize</span><span class="pun">,</span><span class="pln">
                            presentationTimeUs</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="com">/*flags*/</span><span class="pun">);</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">VERBOSE</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"submitted frame "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> inputChunk </span><span class="pun">+</span><span class="pln"> </span><span class="str">" to dec, size="</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                                chunkSize</span><span class="pun">);</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                    inputChunk</span><span class="pun">++;</span><span class="pln">
                    extractor</span><span class="pun">.</span><span class="pln">advance</span><span class="pun">();</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">VERBOSE</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"input buffer not available"</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">outputDone</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> decoderStatus </span><span class="pun">=</span><span class="pln"> decoder</span><span class="pun">.</span><span class="highlight"><span class="pln">dequeueOutputBuffer</span></span><span class="pun">(</span><span class="pln">mBufferInfo</span><span class="pun">,</span><span class="pln"> TIMEOUT_USEC</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">decoderStatus </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_TRY_AGAIN_LATER</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="com">// no output available yet</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">VERBOSE</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"no output from decoder available"</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">decoderStatus </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_BUFFERS_CHANGED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="com">// not important for us, since we're using Surface</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">VERBOSE</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"decoder output buffers changed"</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">decoderStatus </span><span class="pun">==</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">INFO_OUTPUT_FORMAT_CHANGED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="typ">MediaFormat</span><span class="pln"> newFormat </span><span class="pun">=</span><span class="pln"> decoder</span><span class="pun">.</span><span class="pln">getOutputFormat</span><span class="pun">();</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">VERBOSE</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"decoder output format changed: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> newFormat</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">decoderStatus </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RuntimeException</span><span class="pun">(</span><span class="pln">
                        </span><span class="str">"unexpected result from decoder.</span><span class="highlight"><span class="str">dequeueOutputBuffer</span></span><span class="str">: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                                decoderStatus</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="com">// decoderStatus &gt;= 0</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">firstInputTimeNsec </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="com">// Log the delay from the first buffer of input to the first buffer</span><span class="pln">
                    </span><span class="com">// of output.</span><span class="pln">
                    </span><span class="kwd">long</span><span class="pln"> nowNsec </span><span class="pun">=</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="pln">nanoTime</span><span class="pun">();</span><span class="pln">
                    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"startup lag "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">((</span><span class="pln">nowNsec</span><span class="pun">-</span><span class="pln">firstInputTimeNsec</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">1000000.0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">" ms"</span><span class="pun">);</span><span class="pln">
                    firstInputTimeNsec </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="kwd">boolean</span><span class="pln"> doLoop </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">VERBOSE</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"surface decoder given buffer "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> decoderStatus </span><span class="pun">+</span><span class="pln">
                        </span><span class="str">" (size="</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> mBufferInfo</span><span class="pun">.</span><span class="pln">size </span><span class="pun">+</span><span class="pln"> </span><span class="str">")"</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">mBufferInfo</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">&amp;</span><span class="pln"> </span><span class="typ">MediaCodec</span><span class="pun">.</span><span class="pln">BUFFER_FLAG_END_OF_STREAM</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">VERBOSE</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"output EOS"</span><span class="pun">);</span><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mLoop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        doLoop </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        outputDone </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">

                </span><span class="kwd">boolean</span><span class="pln"> doRender </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mBufferInfo</span><span class="pun">.</span><span class="pln">size </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">

                </span><span class="com">// As soon as we call releaseOutputBuffer, the buffer will be forwarded</span><span class="pln">
                </span><span class="com">// to SurfaceTexture to convert to a texture.  We can't control when it</span><span class="pln">
                </span><span class="com">// appears on-screen, but we can manage the pace at which we release</span><span class="pln">
                </span><span class="com">// the buffers.</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">doRender </span><span class="pun">&amp;&amp;</span><span class="pln"> frameCallback </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    frameCallback</span><span class="pun">.</span><span class="pln">preRender</span><span class="pun">(</span><span class="pln">mBufferInfo</span><span class="pun">.</span><span class="pln">presentationTimeUs</span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                decoder</span><span class="pun">.</span><span class="pln">releaseOutputBuffer</span><span class="pun">(</span><span class="pln">decoderStatus</span><span class="pun">,</span><span class="pln"> doRender</span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">doRender </span><span class="pun">&amp;&amp;</span><span class="pln"> frameCallback </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    frameCallback</span><span class="pun">.</span><span class="pln">postRender</span><span class="pun">();</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">

                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">doLoop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">d</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Reached EOS, looping"</span><span class="pun">);</span><span class="pln">
                    extractor</span><span class="pun">.</span><span class="pln">seekTo</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="typ">MediaExtractor</span><span class="pun">.</span><span class="pln">SEEK_TO_CLOSEST_SYNC</span><span class="pun">);</span><span class="pln">
                    inputDone </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
                    decoder</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span><span class="pln">    </span><span class="com">// reset decoder state</span><span class="pln">
                    frameCallback</span><span class="pun">.</span><span class="pln">loopReset</span><span class="pun">();</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
 </span></pre>
			</div>

		</div>



				<!-- java api examples - bottom 
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-5732630628268628"
     data-ad-slot="6827668015"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
-->

<script type="text/rocketscript" data-rocketoptimized="true">
		$('.vote').hover(
			function () {
				$(this).addClass("hover");
			},
			function () {
				$(this).removeClass("hover");
			}
		);
		
		
		//$("pre").highlight("MediaCodec", {caseSensitive:true});
		$("pre").highlight("dequeueOutputBuffer", {caseSensitive:true});
		//$(this).html().replace( new RegExp(MediaCodec, "ig") ,'<div style="background-color:red">' + MediaCodec + '</div>')
		
</script>

</div>

<div style="height: 1px; width: 100%; clear:both;"></div>


	<!-- footer -->

	<div id="footer">
	
		
		<div style="width: 800px; margin:0 auto;">
		
			<!--The examples above are mined from open source projects. Each example
			has a reference to <br> its resource, but the http link may not be
			provided due to the evoluation of the project.
			-->
			<style>
				#footer-list li{
					font-size: 13px;
					display: inline-block;

					padding:3px;
					text-align: center;
				}

			</style>
			<ul id="footer-list">

				<li><a href="http://www.programcreek.com/java-api-examples/index.php?action=privacy">Terms of Use</a></li>
				<li><a href="http://www.programcreek.com/java-api-examples/index.php?action=privacy">Privacy</a></li>
				<li><a href="http://www.programcreek.com/java-api-examples/index.php?action=privacy"> Support &amp; Contact</a></li>
			</ul>

		</div>
		
		
		
		<div style="margin-top:15px;">
		<a href="http://www.programcreek.com/"><img alt="Program Creek" src="./Java Code Example_files/pc-logo.png" width="100"></a>
		</div>
		
		
		
	</div>






</div>
	


	
	
</body></html>